var placeholders_supported=('placeholder'in document.createElement('input')),hash_frame=false;var check_sms_handler=0;function SMSStickerClose(){try{document.body.removeChild(__el('error_overlay'))}catch(err){}
try{$('#sms_sticker').remove();}catch(err){}
$.mask.close();}
function OpenPassToggle(prefix){var passopen=document.getElementById('show_pass'+prefix).checked;var opwf=document.getElementById('open_pwd'+prefix);var cpwf=document.getElementById('pwd'+prefix);if(passopen){opwf.value=cpwf.value;}else{cpwf.value=opwf.value;}
cpwf.style.display=passopen?'none':'inline';opwf.style.display=passopen?'inline':'none';}
Function.prototype.bind=function(object){var method=this
return function(){return method.apply(object,arguments)}}
function getCSSRule(ruleName){ruleName=ruleName.toLowerCase();if(document.styleSheets){for(var i=0;i<document.styleSheets.length;i++){var styleSheet=document.styleSheets[i];var ii=0;var cssRule=false;do{if(styleSheet.cssRules){cssRule=styleSheet.cssRules[ii];}else if(styleSheet.rules){cssRule=styleSheet.rules[ii];}
if(cssRule&&cssRule.selectorText){if(cssRule.selectorText.toLowerCase()==ruleName){return cssRule;}}
ii++;}while(cssRule)}}
return false;}
function cloneCSSRule(selector,doc){if(!doc)doc=document;var sheet=doc.styleSheets[0];var cr=getCSSRule(selector);if(sheet&&cr&&cr.style){if(sheet.insertRule){if(cr.cssText)sheet.insertRule(cr.cssText,0);}else{for(var r in cr.style){if(r=='cssText')continue;if(cr.style[r]!=''){var rr=r.replace(/[A-Z]/g,function(s){return'-'+s.toLowerCase()});if(sheet.addRule){var rs=cr.style[r];if(/(error_sticker|error_overlay)$/.test(selector)){if(rr=='position')rs='absolute';if(rr=='top')rs='expression(ignoreMe = document.documentElement.scrollTop + "px")';}
sheet.addRule(selector,rr+':'+rs,0);}}}}}}
function ClosePopOffersForm(){SMSStickerClose();var curr_date=new Date();GUJ.PutRequest({url:'/pages/ajax_epmty/',params:{action:'set_subscr_reminder',utc_offset_min:-curr_date.getTimezoneOffset(),rand:Math.random()}});return false;}
var CustomAlertBox=function(){this.visible=false;this.msgs=new Array();this.tmp_eval=Array();this.errorSticker=document.createElement('div');this.errorSticker.className="error_sticker";this.errorSticker.innerHTML='<div class="err_title">Сообщение</div>';this.errorStickerText=document.createElement('p');this.errorStickerText.className="err_text";this.errorSticker.appendChild(this.errorStickerText);this.errorStickerButtons=Array();for(var i=0;i<3;i++){this.errorStickerButtons[i]=document.createElement('input');this.errorStickerButtons[i].type='button';this.errorStickerButtons[i].className='coolbutn';}
this.errorStickerButtons[0].value='OK';this.errorStickerButtons[0].style.width='70px';this.errorStickerButtons[0].onclick=this.evalclose.bind(this);this.errorStickerButtons[1].value='';this.errorStickerButtons[1].style.marginLeft='10px';this.errorStickerButtons[1].style.display='none';this.errorStickerButtons[1].onclick=this.evalclose2.bind(this);this.errorStickerButtons[2].value='Отмена';this.errorStickerButtons[2].style.width='70px';this.errorStickerButtons[2].style.marginLeft='10px';this.errorStickerButtons[2].onclick=this.close.bind(this);this.errorSticker.appendChild(this.errorStickerButtons[0]);this.errorSticker.appendChild(this.errorStickerButtons[1]);this.errorSticker.appendChild(this.errorStickerButtons[2]);this.errorOverlay=document.createElement('div');this.errorOverlay.className="error_overlay";}
CustomAlertBox.prototype.close=function(){var doc;try{doc=window.parent&&window.parent.document;}catch(e){doc=document;};doc.body.removeChild(this.errorSticker);doc.body.removeChild(this.errorOverlay);this.visible=false;this.errorStickerButtons[1].style.display='none';if(this.msgs.length>0){this.show();}}
CustomAlertBox.prototype.evalclose=function(){if(typeof(this.tmp_eval[0])!='undefined')this.tmp_eval[0]();this.close();}
CustomAlertBox.prototype.evalclose2=function(){if(typeof(this.tmp_eval[1])!='undefined')this.tmp_eval[1]();this.close();}
var AddStylesToTop=['.coolbutn','input.coolbutn','.error_overlay','.error_sticker','.err_text','.err_title','.error_sticker .err_text','.error_sticker .coolbutn'];CustomAlertBox.prototype.show=function(){var str=this.msgs.shift();try{var doc=top.document;}catch(e){var doc=document;};this.visible=true;if(str.constructor.toString().indexOf("Array")==-1){this.errorStickerButtons[2].style.display='none';this.tmp_eval[0]=undefined;}else{this.errorStickerButtons[2].style.display='inline';this.tmp_eval[0]=str[1];if(typeof(str[2])!='undefined'){this.tmp_eval[1]=str[2];}
str=str[0];}
this.errorStickerText.innerHTML=str;if(doc!==document&&!doc.cssAdded){for(var i=0;i<AddStylesToTop.length;i++){cloneCSSRule(AddStylesToTop[i],doc);}
top.document.cssAdded=true;}
if(doc.body!=null){doc.body.appendChild(this.errorOverlay);doc.body.appendChild(this.errorSticker);}
this.errorSticker.style.top=(this.errorOverlay.clientHeight-this.errorSticker.clientHeight)/4+'px';this.errorSticker.style.left=(this.errorOverlay.clientWidth-this.errorSticker.clientWidth)/2+'px';}
CustomAlertBox.prototype.alert=function(str,confirm,confirm2){str=str.toString().replace(/\n/g,'<br />');if(typeof(confirm)!='undefined'){if(typeof(confirm2)!='undefined'){this.msgs.push(new Array(str,confirm,confirm2));}else
this.msgs.push(new Array(str,confirm));}
else
this.msgs.push(str);if(!this.visible){this.show();}}
function LoginRegisterCancel(msg){alertBox.errorStickerButtons[0].value='Войти';alertBox.errorStickerButtons[1].value='Зарегистрироваться';alertBox.errorStickerButtons[1].style.display='inline';alertBox.errorStickerButtons[1].style.width='150px';alertBox.alert(msg,function logexec(){window.location.href='/pages/login/';},function regexec(){window.location.href='/pages/registration/';});}
var alertBox=new CustomAlertBox();if(window.parent==window.top||!/(MSIE)\s+6\D+/i.test(navigator.userAgent)){window.alert=function(str){if(window.top.alertBox){window.top.alertBox.errorStickerButtons[0].value='OK';window.top.alertBox.alert(str);}else{alertBox.errorStickerButtons[0].value='OK';alertBox.alert(str);}};}
function SpoilerSaveState(nodeId,state){var exdate=new Date();exdate.setDate(exdate.getDate()+180);document.cookie="spoiler_"+nodeId+"="+escape(state)+
";expires="+exdate.toUTCString()+";path=/";}
function ExpandNode(nodeId,dspl){dspl=dspl?dspl:'block';clickedElement=document.getElementById(nodeId).style;titNodeId=nodeId+'_title';if(!clickedElement)
clickedElement=document.all.nodeId.style
if(!clickedElement)
return 1
if(clickedElement.display==dspl){clickedElement.display="none";$('#'+titNodeId).removeClass(titNodeId+'_expanded').addClass(titNodeId+'_collapsed');if(document.getElementById('img_'+nodeId))
document.getElementById('img_'+nodeId).src=document.getElementById('img_'+nodeId).src.replace('minus.gif',"plus.gif");state=0;}else{if((currentExpanded)&&(collapsePrevious))
currentExpanded.display="none";currentExpanded=clickedElement;currentExpanded.display=dspl;$('#'+titNodeId).removeClass(titNodeId+'_collapsed').addClass(titNodeId+'_expanded');if(document.getElementById('img_'+nodeId))
document.getElementById('img_'+nodeId).src=document.getElementById('img_'+nodeId).src.replace("plus.gif",'minus.gif');state=1;}
if($('#'+titNodeId).hasClass('persist_spoiler'))
SpoilerSaveState(nodeId,state);ToggledAlready=1;}
function PurchaseBasket(o){var PriceTotal=o.price?o.price:$('#total_qbasket_summ').text();if(/,/.test(PriceTotal))PriceTotal=parseFloat(PriceTotal.replace(',','.')).toFixed(2);var NeedMoney=(parseFloat(PriceTotal)-o.amount).toFixed(2);if(NeedMoney>0){if(NeedMoney<10)NeedMoney=10;if(litres.isNewPayment&&!o.noNewPayment){Payment.open({basket:1,ref_url:socnet_ref_url});}else{if($('#rebill-quick-purchase-bubble').length&&o.basket){$('#rebill-quick-purchase-bubble').overlay().load();rebill.price=PriceTotal;rebill.ref_url='/pages/my_books/?action=do_order';if(o.custom_set)rebill.ref_url+='&custom_set='+o.custom_set;$('#rebill-quick-purchase-bubble .buy_download_popup_text').html(rebill.title);return;}
var href='';if(o.custom_set){href='/pages/put_money_on_account/?summ='+NeedMoney+'&custom_set='+o.custom_set;}else{href='/?action=create_custom_set&buy_now=true&basket=true';}
window.location.href=href;}
return;}
var CMess=ConfirmPay1+RubPrice(PriceTotal)+ConfirmPay2+'и все отложенные книги будут куплены. '+ConfirmPay3;var CFunc=function exec(){var href='/pages/my_books/?action=do_order';if(o.custom_set)href+='&custom_set='+o.custom_set;document.location.href=href;}
alertBox.errorStickerButtons[0].value='OK';alertBox.alert(CMess,CFunc);}
function TrendyWarnQuickBuy(Obj,Summ,PreOrder,Art,User,Price){var c_lass=Obj.className;var matches=c_lass.match(/free_get/);if(matches==null){var Descr='Cразу после этого вы сможете скачать эту книгу. ';if(PreOrder==2){Descr='Сразу после этого вы сможете продолжить чтение. ';}else if(PreOrder){Descr='Сразу после этого ваш предзаказ будет принят и помещен в «Мои книги». ';}
var CMess=ConfirmPay1+RubPrice(Summ)+ConfirmPay2+Descr+ConfirmPay3;var CFunc=function exec(){top.window.location.href=Obj.getAttribute('href');};if(window.parent==window.top||!/(MSIE)\s+6\D+/i.test(navigator.userAgent)){alertBox.errorStickerButtons[0].value='OK';alertBox.alert(CMess,CFunc);}else if(confirm(CMess))CFunc();}
if($.browser.msie){event.returnValue=false;}
return false;}
function TrendyWarnGift(Obj,Art){var CMess='Cразу после этого у вас спишется 1 подарок и Вы сможете скачать эту книгу.';var CFunc=function exec(){top.window.location.href=Obj.getAttribute('href');};if(window.parent==window.top||!/(MSIE)\s+6\D+/i.test(navigator.userAgent)){alertBox.errorStickerButtons[0].value='OK';alertBox.alert(CMess,CFunc);}else if(confirm(CMess))CFunc();return false;}
var MetaCash=new Object;function getMetaContents(mn){if(MetaCash[mn])return MetaCash[mn];var m=document.getElementsByTagName('meta');for(var i in m){if(!MetaCash[mn])MetaCash[mn]=m[i].content;if(m[i].name==mn)return m[i].content;}
return'';}
function decOfNum(number,titles)
{cases=[2,0,1,1,1,2];number=number%100>4&&number%100<20?2:cases[Math.min(number%10,5)];return titles[number];}
function LoadBubble(status){if(status==='close'){$('#login-bubble').removeClass('quick-reg');$("#loginfailblock").toggle(!!$("#loginfailblock span").text().length);$(".registration").css('visibility','hidden');$('#frm_quick_login').css('visibility','inherit');$("#div-quick-reg").hide();$("#div-quick-login").show();$('.login-link input[name=ref_url]').val(def_ref_url);if($(document.body).hasClass('partner_user_landing')){$(document.body).removeClass('partner_user_landing partner_user_landing_login');$('#quick_regform input[name="action"]').val('register_user');$('#quick_regform').attr('action','/pages/registration/');$('#partner_user_landing_user').remove();}}else if(status==='load'){$('#login_fast_inp').focus();$('#login-bubble input[name=ref_url]').val(def_ref_url);if(!SocNet.services.fb)SocNet.push('fb',{InitCall:true});if(!SocNet.services.vk)SocNet.push('vk',{InitCall:true});if(!SocNet.services.ma)SocNet.push('ma',{InitCall:true});}}
BodyEndFunc.push({'extinputs_init':function(){def_ref_url=$('#login-bubble input[name=ref_url]').val();$(".ext-input").wrap('<span class="ext-input-wrap" />');$(".ext-button").each(function(){var wrap=$('<span class="ext-button-wrap" />');if($(this).is('.ext-button-green'))wrap.addClass('ext-button-wrap-green');if($(this).is('.ext-button-gray'))wrap.addClass('ext-button-wrap-gray');$(this).wrap(wrap);});if(!placeholders_supported){$(':input[placeholder]').each(function(){$(this).placeholder();});}
$("input.inum").bind('keydown',function(event){if(event.keyCode!=46&&event.keyCode!=86&&event.keyCode!=8&&event.keyCode!=9&&event.keyCode!=37&&event.keyCode!=39&&(event.keyCode<48||(event.keyCode>57&&event.keyCode<96)||event.keyCode>105)){event.preventDefault();}});$("input.inum").bind('keyup blur',function(){var t=$(this);t.val(t.val().replace(/[^\d]/g,''));});$(".login-link, .login-link-car").click(function(){$("#login-bubble").data('overlay').load();return false;});if($('.biblio-link#login-bubble').length){$("#login-bubble").overlay({speed:100,mask:{color:'#000',loadSpeed:200,opacity:0.7},load:true,fixed:false});}else if($('#header').length){$("#login-bubble").overlay({fixed:false,speed:100,onClose:function(){LoadBubble('close');$.mask.close();},onLoad:function(){LoadBubble('load');$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#login-bubble").data("overlay").close();if($('.login-link-car').length)$("#login-bubble").data("overlay").close();}});}});}
var formtabs=$('#frm_quick_login,#quick_regform');formtabs.each(function(){var t=$(this),max_tab=0,tab=t.find('*[tabindex]');tab.each(function(){if(parseFloat($(this).attr('tabindex'))>max_tab){max_tab=parseFloat($(this).attr('tabindex'));}});tab.keydown(function(event){if(event.keyCode==9){var currentIndex=$(this).attr("tabindex");var newIndex=event.shiftKey?(currentIndex-1)%max_tab:(currentIndex+1)%max_tab;if(newIndex==0)newIndex=max_tab;var el=$(this).find('*[tabindex='+newIndex+']');if(el.attr("type")=="text")
t.find('*[tabindex='+newIndex+']').select();else
t.find('*[tabindex='+newIndex+']').focus();event.preventDefault();}});});$(".biblio-link").click(function(){$("#login-bubble").data('overlay').load();return false;});$('#pass-auto').click(function(){$('#pass-manual').show();$(this).hide();});if(document.getElementById('download_drm1')){$("#download_drm1").overlay({fixed:false,speed:10,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#download_drm1").data("overlay").close();}});}});$('.buttons_load .cancel').click(function(){$("#download_drm1").data("overlay").close();});}
if(document.getElementById('en_drm')){$("#en_drm").overlay({fixed:false,speed:100,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#en_drm").data("overlay").close();}});}});}
if(document.getElementById('others-link')){$("#others-link").overlay({fixed:false,speed:100,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#others-link").data("overlay").close();}});}});}
if(document.getElementById('lock_mini_drm')){$("#lock_mini_drm").overlay({fixed:false,speed:100,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#lock_mini_drm").data("overlay").close();}});}});}
$('.filter_links > td > a').click(function(){$('#min_price').val("");$('#max_price').val("");if($(this).index()==0)$('#max_price').val('3000');else if($(this).index()==1){$('#min_price').val('3000');$('#max_price').val('5000');}
else if($(this).index()==2)$('#min_price').val('5000');});var free_data,free_price;$('a.free_get').click(function(){free_data=gift_data[$(this).attr('rel')];if(free_data.free_amount<=20){$('#hg-pop-tooltip').addClass('free_book_get');free_price=$(this).attr('onclick').split(',')[1]+' <span class="litres_ruble">&#8381;</span>';$('#hg-pop-tooltip').css({left:$(this).offset().left-79,top:$(this).offset().top+10}).show();if(free_price==null){free_price=$('.book_descr_links').children('.td').children('.simple_price').html();$('#hg-pop-tooltip').css({left:$(this).offset().left-15,top:$(this).offset().top+40}).show();}
var free_amount_text=["книгу","книги","книг"][free_data.free_amount%10==1&&free_data.free_amount%100!=11?0:free_data.free_amount%10>=2&&free_data.free_amount%10<=4&&(free_data.free_amount%100<10||free_data.free_amount%100>=20)?1:2];$('#hg-pop-tooltip .close').show();$('#hg-content').html('<div id="free-download">'+
'<a href="'+free_data.href2+'" class="coolbtn btn-blue-18"><u></u>Скачать бесплатно<s></s></a>'+
(free_data.free_amount<=10?'<p class="free-d-text'+(free_data.free_amount>9?" free_alt":"")+'"><span>'+free_data.free_amount+'</span>'+free_amount_text+' еще можно<br/>скачать бесплатно</p>':'')+
'<p class="free-d-text2">Не хотите по подписке?</p>'+
'<a href="'+free_data.buy+'" onclick="'+$(this).attr('onclick')+'" class="buy-book">Купить за '+free_price+'</a>'+
'</div>');$('#hg-overlay').show();return false;}else document.location=free_data.href2;});var art,tooltip,mark,i;genstars=function(t,mark){t.html("");art=stars_data['a_'+t.attr('id')];if(mark){art.votes[mark-1]++;if(art.voted)art.votes[art.voted-1]--;else art.vote_amount++;if(art.mid_vote==0&&art.vote_amount==1)art.mid_vote=mark;else{var tmp=0;for(i=1;i<=5;i++)tmp+=art.votes[i-1]*i;art.mid_vote=(tmp/art.vote_amount).toFixed(2);}
art.voted=mark;}
var tmp2=art.mid_vote;tmp2=tmp2.toString().substr(2);tmp2=tmp2.length==1?tmp2+'0':tmp2;for(i=1;i<=5;i++){var a_class="";if(art.mid_vote<i&&art.mid_vote>i-1&&tmp2>=26&&tmp2<=75)a_class=" voted-half";else if((art.mid_vote>=i&&((art.voted>0&&art.vote_amount>1)||(art.voted==0&&art.vote_amount>0)))||(art.voted>=i&&art.vote_amount==1)||(art.mid_vote<i&&art.mid_vote>i-1&&tmp2>=76))a_class=" voted";t.append('<a href="javascript:void(0);" class="star'+a_class+'" id="'+i+'"><span></span></a>');}
if(!t.hasClass('bigstars')){t.children('a:last').css("padding-right","4px");}else{var star_close=$('.bigstars').html();var vote_number=art.vote_amount>0?'<span class="votes">(<span>'+art.vote_amount+'</span>)</span>':'';$('.bigstars').html('<div class="g_star"><span class="item">'+star_close+'</span>'+vote_number+'</div>');}};$('.stars_book').each(function(){genstars($(this));});$('.stars_book a').live('click',function(){var parent=$(this).closest('.stars_book');var id=parent.attr('id');art=stars_data['a_'+id];mark=$(this).attr('id');if(art.logined==0){$("#loginfailblock").html('Для того чтобы поставить оценку Вы должны авторизоваться').show();$("#login-bubble").data("overlay").load();$('#login-bubble input[name=ref_url]').val($('#login-bubble input[name=ref_url]').val()+($('#login-bubble input[name=ref_url]').val().match(/\?/)?'&':'?')+'action=votestars&art='+id+'&mark='+mark+'&rand='+Math.random());return false;}else{if(mark!=art.voted){if(mark>=1||mark<=5||id){var Request={url:'/pages/ajax_epmty/',OnData:function(Data){if(Data=='ok'){genstars(parent,mark);}else if(/already_voted/.test(Data[0]))alert("Вы уже голосовали за это произведение.");else alert("Произошла ошибка: "+Data[0]);},params:{action:'votestars',art:id,mark:mark,rand:Math.random()}};GUJ.PutRequest(Request);}}else return false;}});$('.stars_book a').live('mouseenter',function(){if($('.new-book-over-cover .download-links .formats a').length>0)
$('.new-book-over-cover .download-links .formats a').removeClass('clicked')
$("#hg-pop_close").hide();$(this).prevAll().andSelf().addClass('star-hover');var parent=$(this).closest('.stars_book');art=stars_data['a_'+parent.attr('id')];var max_vote=Math.max.apply(null,art.votes);var vote_amount_text=["оценка","оценки","оценок"][art.vote_amount%10==1&&art.vote_amount%100!=11?0:art.vote_amount%10>=2&&art.vote_amount%10<=4&&(art.vote_amount%100<10||art.vote_amount%100>=20)?1:2];tooltip=(art.voted==0?'<p class="vote-info">Оценить книгу на '+$(this).attr('id')+'!</p>':'')+
'<p class="voted-info">Всего '+art.vote_amount+' '+vote_amount_text+'.<br />Средняя оценка '+art.mid_vote+'.</p>'
+(art.voted?'<p class="old-vote-info">Моя оценка '+art.voted+'.</p>'+(art.voted!=$(this).attr('id')?'<p class="vote-info">Изменить на '+$(this).attr('id')+'!</p>':'<p class="vote-info">Оставить оценку</p>'):'');var table='<dl>';for(i=5;i>0;i--)
table+='<dt'+(art.voted==i?' class="alt"':"")+'>'+i+'</dt>'+
'<dd'+(art.voted==i?' class="alt"':"")+'><div style="width:'+(art.votes[i-1]==0?0:Math.floor(100*art.votes[i-1]/max_vote))+'px;"></div><span>('+art.votes[i-1]+')</span></dd>';table+='</dl>';$('#hg-content:not(.langs)').addClass('votestars').html(tooltip+table);if($(this).closest('bigstars'))$('#hg-pop-tooltip').css({left:parent.offset().left-44,top:parent.offset().top+21}).show();else $('#hg-pop-tooltip').css({left:parent.offset().left-58,top:parent.offset().top+15}).show();});$('.stars_book a').live('mouseleave',function(){$(this).prevAll().andSelf().removeClass('star-hover');$('#hg-pop-tooltip').hide();$('#hg-content').removeClass('votestars');});if($('.login-link').length){$('.escho_oplat_popup a').click(function(){$("#buy_book_data").slideUp(200,function(){$("#login-bubble").data("overlay").load();$("#div-quick-login").hide();$("#div-quick-reg").show();$(".kykyru-footer-add-alt").addClass('ie7-fix-left-side');});return false;});}
$('#buy_book_data a.close').click(function(){$("#buy_book_data").data("overlay").close();if($('.anonym-sms-buy').length>0){$('.anonym-sms-buy').remove();}
if($('.anonym-webmoney-buy').length>0){$('.anonym-webmoney-buy').remove();}
$('.anonym-pay-buy').show();$.mask.close();});if($('.upsale_read .ur_desc').length){var w=$(window),c=$('.cover');if(w.width()<=600)c.hide();$(w).resize(function(){if(w.width()<=600)c.hide();else c.show();});}
function a_buyany(){var buy_book_data=$('#buy_book_data');if(buy_book_data.length){buy_book_data.data('overlay').load();}}
function a_buypay_webmoney(){$('#a_buypay_webmoney').trigger('click');}
$('#a_buypay_webmoney').click(function(e){e.preventDefault();e.stopPropagation()
WebMoney_OneClick();});$('#a_buypay_sms').click(function(e){a_buypay_sms_init();e.preventDefault();});function a_buypay_sms_init(){op_change_link='<a href="javascript:void(0)" class="change_op">изменить оператора</a>';$('.pay_ments').css('opacity','1');$('.anonym-pay-buy').slideUp(200,function(){var _url='/pages/biblio_basket/';var _params={action:'create_custom_set'};var custom_set=false;if(window.location.href.match('custom_set')!==null){custom_set=window.location.href.split('?')[1].split('=')[1];}
if(!custom_set){var basket=1;var ord_title=false;var ref_urla="/pages/put_money_on_account/?descr=10&sms_popup=1"+
"&ref_url=%2Fpages%2Fmy_books%2F%3Faction%3Ddo_order";if($('#a_buypay_sms').parent('form').length>0){basket=0;var art_id=$('#a_buypay_sms').prevAll('input[name=arts]').val();ord_title=$('#a_buypay_sms').prevAll('input[name=ord_title]').val();var tmp=$('#a_buypay_sms').prevAll('input[name=redir]').val().split("?");tmp=tmp[1].split("&");var tmp_;for(var i=0;i<tmp.length;i++){tmp_=tmp[i].split("=");sms_arr[tmp_[0]]=tmp_[1];}
ref_urla+="&summ="+sms_arr['summ'];}
_params.redir=ref_urla;if(basket){_params.basket=true;}else{_params.ord_title=ord_title;_params.arts=art_id;}}else{_url='/pages/put_money_on_account/';_params={descr:10,sms_popup:1,custom_set:custom_set};}
var get_sms_data={url:_url,params:_params,OnHTML:function(HTML){$('.sms_data_status').remove();$('.anonym-sms-buy .gray-corners').html(HTML);p_url='&summ='+op[0]['summ_need']+'&ref_url='+op[0]['ref_url']+(op[0]['custom_set']?'&custom_set='+op[0]['custom_set']:'');var tmp2='<div class="kykyru-footer-add-alt">'+
'<ul class="pay_ments"><li><a href="javascript:void(0)" class="p_other">Другие способы оплаты</a></li>';for(m in other_pays)
tmp2+='<li><a href="/pages/put_money_on_account/?'+other_pays[m]+p_url+'" class="'+m+'" title="'+pays_titles[m]+'"></a></li>';$('.anonym-sms-buy').append(tmp2+'</ul></div>');if(smspopState!=0){if(smspopState==22||smspopState==42||smspopState==92||smspopState==44){$('.operators li#'+smspopState+' a').trigger('click');}else{$('#country-change select option').attr('selected','');$('#country-change select option[value='+(smspopState==57?3:1)+']').attr("selected","selected").trigger('change');$('#operator-change select option').attr('selected','');$('#operator-change select option[value='+smspopState+']').attr("selected","selected").trigger('change');return;}
smspopState=0;}
set_step(1);}};GUJ.PutRequest(get_sms_data);$(this).after('<div class="anonym-sms-buy"><div class="buy_download_popup_text">'+$('.buy_download_popup_text').html()+'</div></div>');$('.anonym-sms-buy .buy_download_popup_text p').html('Если вы уже регистрировались или покупали книги на нашем сайте,<br />воспользуйтесь <a href="/pages/login/">входом в систему</a> для пополнения своего счета.');$('.anonym-sms-buy .buy_download_popup_text strong').html('Оплата со счета мобильного телефона.');$('.anonym-sms-buy').append('<p id="sms-step-text">Выберите оператора:</p>'+
'<div class="gray-corners corners"><div class="sms_data_status"><img alt="" src="/static/new/i/ajax_progress.gif" width="16" height="16" /></div></div>');$('.anonym-sms-buy').slideDown(200);});return false;}
if($("#buy_book_data").length>0){$("#buy_book_data").overlay({fixed:false,speed:100,onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$('#buy_book_data').data("overlay").close();if($("#login-bubble").length)$("#login-bubble").data("overlay").close();if($('.anonym-sms-buy').length){$('.anonym-sms-buy').remove();}
if($('.anonym-webmoney-buy').length){$('.anonym-webmoney-buy').remove();}
if($('.anonym-pay-buy').length)$('.anonym-pay-buy').show();}});}});if(window.location.hash==='#buy_now_noreg'&&$('.new-book').length){$("#buy_book_data").data('overlay').load();}}
$('#a_buyany').click(function(){a_buyany();});if(window.location.hash==='#buy_now_reg'&&$('.new-book').length){$('#reg_buynow a, #reg_buynow button').click();}
if($('.login-link').length)
$("a[href*='/pages/registration/']").click(function(){ShowRegPopup();return false;});if($('.litres_touch .okno').length>0){$('.okno .cell:first').addClass('c_current').addClass('a_active');$('.rakurs .arrow_down').click(function(){var cur=$('.okno .c_current');tmp=(cur.index()+1)*81;if(tmp==405||!cur.next().size()){num=0;$('.okno .cell:first').addClass('c_current');cur.removeClass('c_current');}else if(cur.next().size()){cur.removeClass('c_current').next().addClass('c_current');num=tmp;}
$('.okno .inner').css("margin-top","-"+num+"px");return false;});rotate=function(){var act=$('.okno .a_active');act.removeClass('a_active');if(act.next().size())
a_next=act.next().addClass('a_active');else
a_next=$('.okno .cell:first').addClass('a_active');$('.device img').fadeOut(200,function(){$('.device img').attr("src","/static/new/i/"
+((!$('.litres_touch').hasClass('prize'))?"litres_touch/device_":"greedy/bookine-device_")+a_next.index()+".jpg").fadeIn(300,function(){});});};var gg=setInterval('rotate()',3000);$('.okno, .pic').hover(function(){gg=window.clearInterval(gg);},function(){gg=setInterval('rotate()',3000);});$('.rakurs .arrow_up').click(function(){var cur=$('.okno .c_current');tmp=(cur.index()-1)*81;if(tmp==0){num=0;cur.removeClass('c_current').prev().addClass('c_current');}else if(!cur.prev().size()){num=243;cur.removeClass('c_current');$('.okno .cell:eq(3)').addClass('c_current');}else if(cur.prev().size()){num=tmp;cur.removeClass('c_current').prev().addClass('c_current');}
$('.okno .inner').css("margin-top","-"+num+"px");return false;});$('.okno .cell').click(function(){$('.okno .cell').removeClass('a_active');$(this).addClass('a_active');$('.device img').attr("src","/static/new/i/"
+((!$('.litres_touch').hasClass('prize'))?"litres_touch/device_":"greedy/bookine-device_")+$(this).index()+".jpg");return false;});}
if(document.getElementById('youtube-popup')){$("#youtube-popup").overlay({fixed:false,speed:100,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#youtube-popup").data("overlay").close();}});}});}
$('#youtube-popup').click(function(){$("#youtube-popup").data('overlay').load();});if(document.getElementById('instruction-popup')){$("#instruction-popup").overlay({fixed:false,speed:100,onClose:function(){$.mask.close();},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#instruction-popup").data("overlay").close();}});}});}
$('#instruction-popup').click(function(){$("#instruction-popup").data('overlay').load();});$('a.p_other').live('click',function(){$('.anonym-sms-buy').remove();$('.anonym-pay-buy').show();return false;});var sms_arr=new Array(),op_change_link,fee,sms_text,p_url,o_id,o_cap,art_name="",smspopState=0;var other_pays={"p_visa":"descr=32","p_mastercard":"descr=32","p_alfa":"descr=41","p_kykyru":"descr=44","p_paypal":"descr=62","p_wm":"descr=50","p_yad":"descr=55","p_qiwi":"descr=7"};var pays_titles={"p_visa":"Visa","p_mastercard":"MasterCard","p_alfa":"Альфа-Клик","p_kykyru":"Карта «Кукуруза»","p_paypal":"PayPal","p_wm":"WebMoney","p_yad":"Яндекс.Деньги","p_qiwi":"QIWI кошелек"};$('.change_country').live('click',function(){$('.country-name').hide();$('#country-change').show();return false;});$('#country-change select').live('change',function(){if($(this).val()==0)return false;var id=$(this).val();$('#country-change').hide();$('.country-name p').text($('#country-change option:selected').text());$('.country-name, #operator-change').show();$('.operators li:not(.tarif, #operator-change)').remove();var tmp='',count=0;for(key in sms){if(key!=0&&sms[key]['c_id']==id){if(count<3&&id!=1)
$('.operators ul').prepend('<li id="'+key+'"><a href="javascript:void(0)">'+sms[key]['cap']+'</a></li>');count++;tmp+="<option value=\""+key+"\">"+sms[key]['cap']+"</option>";}}
if(id==1){$('.operators ul').prepend('<li class="id_42" id="42"><a href="javascript:void(0)">Билайн</a></li>'+
'<li class="id_22" id="22"><a href="javascript:void(0)">МТС</a></li>'+
'<li class="id_92" id="92"><a href="javascript:void(0)">Мегафон</a></li>'+
'<li class="id_44" id="44"><a href="javascript:void(0)">Tele2</a></li>');}
var op_text=["оператор","оператора","операторов"][count%10==1&&count%100!=11?0:count%10>=2&&count%10<=4&&(count%100<10||count%100>=20)?1:2];if(count>3)$('#operator-change select').html('<option value="0">Другой ('+count+' '+op_text+')</option>'+tmp);else{$('#operator-change span select').html('');$('#operator-change').hide();}
set_step(1);});$('.change_op').live('click',function(){step_back();return false;});$('#operator-change select').live('change',function(){if($(this).val()==0)return false;o_id=$(this).val();o_cap=$('#operator-change option:selected').text();if(o_id==42||o_id==22||o_id==92||o_id==44){$('.operators li.op_a').html('<a href="javascript:void(0)">'+$('.operators li.op_a span').html()+'</a>');$('.operators li').removeClass('op_a');$('.operators li#'+o_id).addClass('op_a').show();$('.operators li#'+o_id+' a').trigger('click');changeTarif(o_id);}else $('#postpay').trigger('click');});$('.operators li:not(.tarif) a').live('click',function(){if($(this).parent().hasClass('id_42')||$(this).parent().hasClass('id_22')||$(this).parent().hasClass('id_92')||$(this).parent().hasClass('id_44')){if(!$(this).parent().hasClass('op_a'))$(this).parent().addClass('op_a');changeTarif($('.operators li.op_a').attr('id'));$('.operators li:not(.op_a, .tarif)').hide();$('.operators li.tarif').show();$(this).replaceWith('<span>'+$(this).text()+'</span>');return false;}
o_id=$(this).parent().attr('id');o_cap=$(this).text();$('#postpay').trigger('click');return false;});function changeTarif(id){if(id==42){$('#prepay').html('Предоплатный тариф для частных лиц');$('#postpay').html('Постоплатный или корпоративный тариф');}else{$('#prepay').html('Тариф для частных лиц');$('#postpay').html('Корпоративный тариф');}}
$('#prepay').live('click',function(){set_step(2);var comm={'42':18.9,'92':16.5,'44':17.9};var operator_text=$('.operators li.op_a').attr('id');var operator_name=$('.operators li.op_a').text();var summ_proc,summ_res;if(operator_name=='МТС'){summ_proc=10;summ_res=parseFloat(op[0]['summ_need'])+10;}else if(operator_name=='Билайн'){summ_proc=parseFloat((parseInt(op[0]['summ_need']*comm[operator_text])/100)+10).toFixed(2);summ_res=parseFloat(parseInt(op[0]['summ_need']*(100+comm[operator_text]))/100)+10;}else{summ_proc=parseFloat(parseInt(op[0]['summ_need']*comm[operator_text])/100);summ_res=parseFloat(parseInt(op[0]['summ_need']*(100+comm[operator_text]))/100);}
$('.anonym-sms-buy .buy_download_popup_text p, .anonym-sms-buy .buy_download_popup_text strong').hide();$('#sms-popup-start').hide().after('<div class="op-info">Ваш оператор: <b>'+operator_name+'</b> (предоплатный)'+op_change_link+'<br />'+
'Сумма к оплате: <span>'+summ_res+' <span class="litres_ruble">&#8381;</span></span> включая комиссию '+summ_proc+' <span class="litres_ruble">&#8381;</span></div>');$('.anonym-sms-buy .gray-corners').css('margin','2px 8px 16px').after('<div class="op-data"><span class="some-text">Введите номер своего мобильного телефона:</span>'+
'<div class="user-phone">+7<span class="ext-input-wrap"><input class="ext-input" name="phone" id="phone"/></span>'+
'<button id="prepay-next" class="coolbtn btn-blue-18" value="ОК" type="submit"><u></u>ОК<s></s></button></div>'+
'<p>На указанный номер будет отправленно SMS<br />с запросом на проведение платежа.</p></div>');$('#sms-step-text').hide();return false;});$('#prepay-next').live('click',function(){if($('.phone-error'))$('.phone-error').remove();if($('#phone').val().length==0||($('#phone').val().length&&$('#phone').val().match(/\d+/gi).join('').length<7)){$('.some-text').after('<div class="phone-error">Ошибка: неверный формат номера</div>');return false;}
set_step(3);$('.pay_ments').css('opacity','0.4');$('.pay_ments li a').each(function(i){$(this).replaceWith('<span class="'+$(this).attr('class')+'">'+$(this).text()+'</span>');});var Request={url:'/pages/proceed_payment/',params:{descr:65,summ:op[0]['summ_need'],phone_number:$('#phone').val(),custom_set:op[0]['custom_set'],js:true},HttpRType:'json',OnData:function(Data){if(Data==''||Data.error){alert(Data.error);}else{check_sms(65,Data.id);}}};GUJ.PutRequest(Request);$('.user-phone, .some-text').remove();$('.op-data p').before('<div class="sms-progress prepay-final-text">Ожидание подтверждения платежа. Не закрывайте это<br />'+
'окошко и не переходите на другую страницу до получения<br /> SMS уведомления о завершении операции.</div>').html('Выполнение платежа и отправка SMS может занять несколько минут.');$('.anonym-sms-buy .buy_download_popup_text').css('padding-bottom','9px').append('<strong style="padding-top:27px;">Подтвердите платеж:</strong>');$('.anonym-sms-buy .gray-corners').html('<div id="sms-buy-final">После того, как Вам пришло SMS с короткого номера, проверьте '+
'детали платежа и отправьте ответное SMS'+($('.operators li.op_a').attr('id')==22?' на этот номер с любым текстом или пустое':'<br />с указанной цифрой на этот номер')+'.</div>');return false;});$('#postpay').live('click',function(){set_step(2);if($('.operators li.op_a').attr('id')){o_id=$('.operators li.op_a').attr('id');o_cap=$('.operators li.op_a span').text();}
if(op[o_id]==undefined){no_sms(o_cap);return false;}
cost=op[o_id]['currency']=='р.'?op[0]['summ_need']:op[0]['summ_need']/op[o_id]['course'];$('.anonym-sms-buy .buy_download_popup_text p, .anonym-sms-buy .buy_download_popup_text strong').hide();var tmp_=$('.operators li.op_a').attr('id')=='42'||$('.operators li.op_a').attr('id')=='22'||$('.operators li.op_a').attr('id')=='92'?' (постоплатный)':'';$('#sms-popup-start').hide().after('<div class="op-info">Ваш оператор: <b>'+o_cap+'</b>'+tmp_+''+op_change_link+'<br />'+
'Стоимость SMS составит<span> '+op[o_id]['cost']+' '+(op[o_id]['currency']=='р.'?'<span class="litres_ruble">&#8381;</span>':op[o_id]['currency'])+'*</span>');var tmp2='<div class="op-data postpay"><span class="some-text">Отправьте на номер <strong>'+op[o_id]['number']+'</strong> SMS с текстом:</span>'+
'<div class="op-sms-text">';sms_text=op[o_id]['prefix']+' '+op[0]['small_id'];for(var i=0;i<sms_text.length;i++){tmp2+='<span'+(i>(sms_text.length-5)&&i<(sms_text.length-1)?' class="alt"':'')+'>'+sms_text.substr(i,1)+'</span>';}
tmp2+='</div><small>Внимание! Пробел между '+op[o_id]['prefix']+' и числом '+op[0]['small_id']+' обязателен.</small><br />'+
'<a href="javascript:void(0);" id="postpay-next">Нажмите сюда после отправки SMS</a>';if(op[o_id]['course']>0||op[o_id]['currency']=='р.'){sms_cost=op[o_id]['currency']=='р.'?op[o_id]['summ']:op[o_id]['summ']/op[o_id]['course'];fee=(op[o_id]['cost']-sms_cost).toFixed(2);money=((op[o_id]['cost']-fee-cost)*op[o_id]['course']).toFixed(2);tmp2+='<p>* Стоимость включает НДС. Комиссия оператора '+fee+' '+(op[o_id]['currency']=='р.'?'<span class="litres_ruble">&#8381;</span>':op[o_id]['currency'])+', остаток средств<br />'+
'&nbsp;&nbsp;&nbsp;в размере '+money+' <span class="litres_ruble">&#8381;</span> будет доступен для дальнейших покупок.</p></div>';}
$('.anonym-sms-buy .gray-corners').css('margin','2px 8px 16px').after(tmp2);$('#sms-step-text').hide();return false;});$('#postpay-next').live('click',function(){set_step(3);$('.pay_ments').css('opacity','0.4');$('.pay_ments li a').each(function(i){$(this).replaceWith('<span class="'+$(this).attr('class')+'">'+$(this).text()+'</span>');});check_sms(10,op[0]['order_id']);$('.anonym-sms-buy .gray-corners').before('<p class="sms-progress">Ожидается SMS «'+sms_text+'» на номер '+op[o_id]['number']+'...</p>').html('<div id="sms-buy-final">'+
'После завершения покупки на ваш телефон придет SMS, содержащая логин и пароль для повторного доступа на сайт.<br />'+
'Купленная книга будет храниться в он-лайн библиотеке неограниченное время.</div>');$('.postpay').removeClass('postpay').addClass('postpay-next').html('<p>Если Вы отправили SMS, но ничего не происходит в течение 3 минут,<br />'+
'обновите страницу. Если это также не помогло, войдите в систему с помощью<br />'+
'логина и пароля, полученными в сообщении с подтверждением оплаты.</p>');return false;});no_sms=function(cap){$('.anonym-sms-buy .buy_download_popup_text p, .anonym-sms-buy .buy_download_popup_text strong, .anonym-sms-buy .kykyru-footer-add-alt').hide();$('#sms-popup-start').hide().after('<div class="op-info">Ваш оператор: <b>'+cap+'</b> '+op_change_link+'<br /><span class="no-sms">Стоимость книги превышает максимальную стоимость SMS.</span></div>');$('.anonym-sms-buy .gray-corners').css('margin','2px 8px 16px').after('<div class="nosms-data">'+
'<p>Вариант 1. <a id="p_reg" href="/pages/registration/">Зарегистрируйтесь</a>, пополните счет несколькими SMS<br />и самостоятельно завершите покупку.</p>'+
'<p>Вариант 2. Оплатите покупку другим способом:</p>'+
'<ul class="pay_ments">'+
'<li><a href="/pages/put_money_on_account/?descr=32'+p_url+'" class="p_visa" title="Visa"></a><a href="/pages/put_money_on_account/?descr=32'+p_url+'" class="p_mastercard" title="MasterCard"></a>'+
'<a href="/pages/put_money_on_account/?descr=62'+p_url+'" class="p_paypal" title="PayPal"></a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=32'+p_url+'">Кредитная или дебетовая карта Visa, MasterCard, Maestro</a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=62'+p_url+'">PayPal</a></li>'+
'</ul><ul class="pay_ments pay_second">'+
'<li><a href="/pages/put_money_on_account/?descr=50'+p_url+'" class="p_wm" title="WebMoney"></a><a href="/pages/put_money_on_account/?descr=55'+p_url+'" class="p_yad" title="Яндекс.деньги"></a>'+
'<a href="/pages/put_money_on_account/?descr=51'+p_url+'" class="p_qiwi" title="QIWI кошелек"></a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=50'+p_url+'">WebMoney</a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=55'+p_url+'">Яндекс.деньги</a></li>'+
'<li class="p_link"><a class="p_qiwi_link" href="/pages/put_money_on_account/?descr=51'+p_url+'">QIWI кошелек</a></li>'+
'</ul><ul class="pay_ments pay_last">'+
'<li><a href="/pages/put_money_on_account/?descr=41'+p_url+'" class="p_alfa" title="Альфа-Клик"></a><a href="/pages/put_money_on_account/?descr=44'+p_url+'" class="p_kykyru" title="Карта «Кукуруза»"></a>'+
'<a href="/pages/put_money_on_account/?descr=57'+p_url+'" class="p_thanks" title="Сбасибо от сбербанка"></a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=41'+p_url+'">Альфа-Клик</a></li>'+
'<li class="p_link"><a href="/pages/put_money_on_account/?descr=44'+p_url+'">Карта «Кукуруза»</a></li>'+
'<li class="p_link"><a class="p_qiwi_link" href="/pages/put_money_on_account/?descr=57'+p_url+'">«Спасибо» от <br/>Сбербанка»</a></li>'+
'</ul></div>');$('#sms-step-text').hide();};sms_box=new Array(),current_hash='';set_step=function(step){sms_box['step'+step]=$('.anonym-sms-buy').html();window.location.hash='step'+step;current_hash=window.location.hash;}
$(window).bind('hashchange',function(e){if(hash_frame&&window.location.hash==''){hash_frame=false;CloseReadFrame();}
if(current_hash.substr(-1)>window.location.hash.substr(-1)||(current_hash.substr(-1)==1&&current_hash.substr(-1)>window.location.hash.substr(-1))){if(current_hash.substr(-1)==1){$("#buy_book_data").data("overlay").close();window.location.href=window.location.pathname+''+window.location.search;}else{$('.anonym-sms-buy').html(sms_box[window.location.hash.substr(1)]);}
current_hash=window.location.hash;}});step_back=function(){history.go(-1);return false;}
$('.anonym-sms-buy .buy_download_popup_text a,.anonym-webmoney-buy .buy_download_popup_text a').live('click',function(){$("#buy_book_data").slideUp(200,function(){$("#login-bubble").data("overlay").load();});return false;});$('.nosms-data #p_reg').live('click',function(){$("#buy_book_data").slideUp(200,function(){$("#login-bubble").data("overlay").load();$("#div-quick-login").hide();$("#div-quick-reg").show();$(".kykyru-footer-add-alt").addClass('ie7-fix-left-side');});return false;});check_sms=function(type,oid){var Request={url:'/pages/sms_check/',params:{order_id:oid,order_class:type,custom_set:op[0]['custom_set']},HttpRType:'json',OnData:function(Data){if(getCookie('last_autoread')&&getCookie('last_autoread')=='')return;if(Data.status=='ok'){setCookie('last_autoread','',1,'/');document.location=Data.url;}else if(Data.status=='error'){if(Data.msg)alert(Data.msg);else if(Data.url)document.location=Data.url;}else{clearTimeout(check_sms_handler);check_sms_handler=setTimeout('check_sms('+type+', '+oid+')',5000);}},OnDataFail:function(fake1,fake2){}};GUJ.PutRequest(Request);};$('.pay_ments a:not(.p_other, .p_kykyru, .p_qiwi)').live('click',function(){var tmp_,temp=new Array(),tmp=$(this).attr('href').split("?");tmp=tmp[1].split("&");for(var i=0;i<tmp.length;i++){tmp_=tmp[i].split("=");temp[tmp_[0]]=tmp_[1];}
if(temp['descr']==62){return false;}
var Request_tmp={url:'/pages/proceed_payment/',params:{fsubmit:true,descr:temp['descr'],ref_url:temp['ref_url'],summ:temp['summ'],ajax:true}};Request_tmp.params.custom_set=temp['custom_set']>0?temp['custom_set']:'';GUJ.PutRequest(Request_tmp);return false;});$('.pay_ments a.p_qiwi, .pay_ments a.p_qiwi_link').live('click',function(){if($('#a_buybtn_qiwi').lenght){$('#a_buybtn_qiwi').parent().submit();return false;}else
return true;});var popup_onclick=0;$('.payment-q a, .anonym-pay-buy .bg a, .book-icons-a a:not(#a_buybtn_paypal, #a_buybtn_qiwi, #a_buypay_webmoney), .book-icons-b a#a_buybtn_alfaclick').click(function(){if(litres_user_id==0||my_account_email==''){return true;}
if($(this).children('button').attr('id')=='a_buypay_qiwi'||$(this).parent().attr('id')=='pm_51'||$(this).attr('id')=='ps-icon-51'||$(this).attr('id')=='pss-icon-42'||$(this).hasClass('a_buypay_paypal')||$(this).parent().attr('id')=='pm_62'||$(this).attr('id')=='ps-icon-62'||$(this).parent().attr('id')=='pm_32'||$(this).attr('id')=='ps-icon-32'||$(this).parent().attr('id')=='pm_99'||$(this).attr('id')=='ps-icon-99'||$(this).parent().attr('id')=='pm_31'||$(this).parent().attr('id')=='pm_63'||$(this).attr('id')=='ps-icon-63'||$(this).parent().attr('id')=='pm_61'||$(this).attr('id')=='ps-icon-61')return true;var tmp_,temp=new Array(),tmp=$(this).attr('href').split("?");tmp=tmp[1].split("&");for(var i=0;i<tmp.length;i++){tmp_=tmp[i].split("=");temp[tmp_[0]]=tmp_[1];}
if(temp['descr']==61||temp['descr']==60||temp['descr']==65||temp['descr']==45||temp['descr']==10||temp['descr']==18||temp['descr']==44||temp['descr']==42||temp['descr']==43||temp['descr']==35||temp['descr']==1||temp['descr']==25||(temp['descr']==50&&$('#pm_50').hasClass('abtest31082'))||temp['descr']==99||temp['descr']==62||temp['descr']==31)
return true;var Request_tmp={url:'/pages/proceed_payment/',params:{fsubmit:true,descr:temp['descr'],ref_url:temp['ref_url'],summ:temp['summ'],ajax:true}};Request_tmp.params.custom_set=temp['custom_set']>0?temp['custom_set']:'';if($(this).children('button').attr('id')=='a_buypay_visa'&&$('#payonline-iframe').length){PayonlineShowIframe();Request_tmp.params.redir+='&potest=1';}
GUJ.PutRequest(Request_tmp);return false;});$('.old-card button').click(function(){return false;});$('.anonym-pay-buy form button:not(#a_buypay_kukuruza, #a_buypay_sms, #a_buypay_paypal, #a_buypay_webmoney), .book-icons-a button:not(#a_buybtn_paypal, #a_buybtn_qiwi, #a_buybtn_webmoney), .book-icons-b button#a_buybtn_alfaclick').click(function(e){if(this.id=='a_buypay_qiwi'){$('#a_buybtn_qiwi').parent().submit();return false;}
if((this.id=='a_buybtn_visa'||this.id=='a_buybtn_mastercard')&&$('#payonline-iframe').length){a_buyany();setTimeout("$('#a_buypay_visa').trigger('click')",300);e.preventDefault();}
var _arts=$(this).parent('form').children('input[name=arts]').val()>0?$(this).parent('form').children('input[name=arts]').val():0;var tmp=$(this).parent('form').children('input[name=redir]').val().split("?");var _redir='/pages/proceed_payment/?'+tmp[1]+'&ajax=true'+'&fsubmit=true';var _title=$(this).parent('form').children('input[name=ord_title]').val();var _refurl=$(this).parent('form').children('input[name=ref_url]').val()||'';var Request_tmp={url:'/pages/biblio_basket/',params:{action:'create_custom_set',arts:_arts,redir:_redir,ord_title:_title,ref_url:_refurl}};if(this.id=='a_buypay_visa'&&$('#payonline-iframe').length){PayonlineShowIframe();Request_tmp.params.redir+='&potest=1';}
GUJ.PutRequest(Request_tmp);e.preventDefault();});payment_redir=function(desc,sum,ref,set,potest,dmrtest){if(desc==65||desc==45||desc==10||desc==18||desc==44||desc==42||desc==43||desc==35||desc==1||desc==25||desc==99)
return true;sum=parseFloat(sum)<1?1:parseFloat(sum);set=set>0?set:'';if(!popup_onclick&&!FixPrice())return;var Request_tmp={url:'/pages/proceed_payment/',params:{fsubmit:true,descr:desc,ref_url:ref,summ:sum,custom_set:set,ajax:true}};if(desc==63){var _phone_number=$('#sberbank_phone').val();if(_phone_number==''){alert('Не введен номер телефона');return false;}else if(ValidatePhone(_phone_number)!=1){alert('Указан неверный номер телефона');return false;}
Request_tmp.params.js=true;Request_tmp.params.phone_number=_phone_number.replace(/[\+\-\s]/g,'');delete Request_tmp.params.ajax;delete Request_tmp.params.fsubmit;Request_tmp.HttpRType='json';Request_tmp.OnData=function(Data){if(Data==''||Data.error){alert(Data.error);}else{$('#card-orderid').val(Data.id);$('.sberbank-waiter').show();$('#payment-form button[type="submit"]').hide();CheckMoneyUpdateStart();}}}
if(potest){Request_tmp.url+='?potest=1';PayonlineShowIframe();}
if(desc==64){Request_tmp.params.js=true;delete Request_tmp.params.fsubmit;Request_tmp.HttpRType='json';Request_tmp.OnData=function(data){if(data.error){alert(data.error);}
if(data.redirect){window.location.href=data.redirect;}}}
if(dmrtest){Request_tmp.url+='?iframe=1';Request_tmp.OnData=function(data){if(data.error){alert(data.error);}
if(data.redirect){$('#dmrframe').on('load',function(){$('#dmr-iframe').addClass('dmr-loaded');});$('#dmrframe').attr('src',data.redirect);}}
PayonlineShowIframe(false,false,false,false,64);}
GUJ.PutRequest(Request_tmp);return false;};$('.book-icons-b button:not(#a_buybtn_alfaclick), .book-icons-b a:not(#a_buybtn_alfaclick)').click(function(e){a_buyany();setTimeout(function(){a_buypay_sms();return false;},300);if($(this).parent('form').length){smspopState=$(this).parent('form').children('input[name=operator]').val();}else{smspopState=$(this).attr('href').split("&operator=")[1].substr(0,2);}
e.preventDefault();});$('#webmoney-link').live('click',function(){popup_onclick=1;var webmoneyBtn=$('#a_buypay_webmoney'),parent=webmoneyBtn.parent(),custom_set=decodeURIComponent(parent.attr('href')).match(/[&?]custom_set=([^&#]*)/),ref=parent.attr('href')?parent.attr('href'):parent.find('[name=redir]').val();ref=decodeURIComponent(ref.match(/[&?]ref_url=([^&#]*)/)[1]);if(!!custom_set){payment_redir('50',document.getElementById('purchase_price').value,ref,custom_set[1]);}else{var Request_tmp={url:'/pages/biblio_basket/',Method:'get',HttpRType:'json',params:{action:'create_custom_set',js:true},OnData:function(Data){if(Data.custom_set){payment_redir('50',document.getElementById('purchase_price').value,ref,Data.custom_set.id);}}};if($('#a_buybtn_webmoney').parent().find('input[name=arts]').length){Request_tmp.params.arts=$('#a_buybtn_webmoney').parent().find('input[name=arts]').val();}else{Request_tmp.params.basket=true;}
GUJ.PutRequest(Request_tmp);}
return false;});$('#a_buybtn_webmoney').click(function(e){a_buyany()
setTimeout(function(){a_buypay_webmoney()},300);e.preventDefault();});$('.recenses-count a').click(function(){$('html, body').stop().animate({scrollTop:$('#recenses').offset().top},800);});$('#toggle-audio-list a').click(function(){var t1=$(this).find('.showPlaylist'),t2=$(this).find('.hidePlaylist');if(t2.css('display')=='inline'){t2.hide();t1.show();$('#audio-list-roll').fadeOut(400);}else{t1.hide();t2.show();$('#audio-list-roll').fadeIn(400);}});$('#blockcenter #info .rowinfo a.dot').click(function(){var obj=$(this).attr('id')
$(this).removeClass('clicked');$(this).addClass('clicked');$('#hg-pop_close').show();$('#hg-content').html('<div id="readers-pop"> '+$(this).parent().find('.to_show').html()+' </div>');$('#hg-pop-tooltip').css({left:$(this).parent().offset().left,top:$(this).offset().top+$(this).height()}).show();});$('.other_pub .book').find('.item:gt(5)').hide();$('.other_pub-sp a').click(function(){$(this).parent().hide();$(this).closest('.book').find('.item:gt(5)').show();});$("#filter-types a").click(function(){var attr=$(this).attr('id');$("#filter-types li").removeClass('highlight');$(this).parent().addClass('highlight');if(attr=='allf'){$('.inside_block').show();}else{$('.inside_block').hide();$('.'+attr).closest('.inside_block').show();}});$("#reg_me_in_bubble").click(function(){var login=$("#login_fast_inp").val(),pass=$("#open_pwd_fast_inp").val(),nlogin=$("#quick_regform #new_login"),hasmail=nlogin.attr("data-email"),npass=$("#quick_regform #open_pwd_reg_inp"),nswitch=$("#quick_regform [name = 'sw']");if((login==''&&pass=='')||(login=='Логин (электронная почта)'&&pass=='Пароль')){$("#div-quick-login").slideUp(200,function(){$("#div-quick-reg").slideDown(200);$(".registration").css('visibility','inherit');$('#login-bubble').addClass('quick-reg');});nlogin.attr('value',hasmail!=undefined?hasmail:'');npass.attr('value','');nswitch.prop('checked',false);yaLogin_registration();}else{nlogin.attr('value',login);npass.attr('value',pass);nswitch.prop('checked',true);$("#quick_regform").submit();}
nlogin.focus();});$('#login-help-link').on('click',function(){var help_block=$('#login-help-div');if(help_block.text()==''){var html='<p>'
+__l('После совершения покупки на {datahost} регистрация происходит автоматически.',{datahost:help_block.attr('data-host')})+'</p><p>'
+__l('Логин и пароль, выданные вам при регистрации, Вы всегда сможете найти в истории платежей для PayPal, WM, Яндекс.Денег, в SMS сообщении при оплате через SMS и на вашем e-mail при оплате банковской картой.')+'</p><p><a href="/pages/cms/?page=72">'
+__l('Как узнать логин и пароль, полученные после<br/>автоматической регистрации?')+'</a></p>';help_block.html(html);}
help_block.slideToggle();});$('#payment_mobile').on('submit',function(){var phoneNum=$(this).find('input[name="phone_number"]').val();if(phoneNum==''){alert('Не введен номер телефона');return false;}else if(ValidatePhone(phoneNum)!=1){alert('Указан неверный номер телефона');return false;}})}});function PayonlineShowIframe(arts,title,price,other_method,descr){var descr=descr||32;var obj_class=descr==64?'dmr-iframe':'payonline-iframe';if(descr==64){$('#dmr-iframe').removeClass('dmr-loaded');}
if(arts){GUJ.PutRequest({url:'/pages/biblio_basket/',params:{action:'create_custom_set',arts:arts,redir:'/pages/proceed_payment/?summ='+price+'&descr=32&ajax=true&potest=1'+'&fsubmit=true',ord_title:title,ref_url:'/pages/my_books/?action=do_order'}});if(other_method){if(!$("#buy_book_data #other_method").length)
$("#buy_book_data").append('<a id="other_method">Оплатить другим способом</a>');$('#other_method').attr('href',other_method);}}
if($("#buy_book_data").length){$("#buy_book_data").data('overlay').load();$('#buy_book_data .close, #exposeMask').addClass('potest_close')
.live('click',function(){$(this).removeClass('potest_close');$('#'+obj_class).css({'display':'none'});$('.anonym-pay-buy').css('display','block');$('#buy_book_data').css({'width':'517px'});$('#'+obj_class+' iframe').attr('src','about:blank');});$('#'+obj_class).css('display','block');$('.anonym-pay-buy').css('display','none');$('#buy_book_data').animate({'width':'614px'});}else if($('#blockcenter').length){$('#a_buybtn_visa,#a_buybtn_mastercard').live('click',function(){$('#a_buyany').trigger('click');setTimeout("$('#a_buypay_visa').trigger('click')",300);return false;});$('.anonym-pay-buy').css('display','none');$('#'+obj_class).css('display','block');window.parent.document.getElementById('LitresPopup').style.height='700px';window.parent.document.getElementById('LitresPopup').style.width='635px';}}
function WebMoney_OneClick(){$('.anonym-pay-buy').slideUp(200,function(){$(this).after('<div class="anonym-webmoney-buy"><div class="buy_download_popup_text">'+$('.buy_download_popup_text').html()+'</div></div>');$('.anonym-webmoney-buy .buy_download_popup_text p').html('Если вы уже регистрировались или покупали книги на нашем сайте,<br />воспользуйтесь <a href="/pages/login/">входом в систему</a> для пополнения своего счета.');$('.anonym-webmoney-buy .buy_download_popup_text strong').html('Оплата через систему WebMoney');$('.anonym-webmoney-buy').append('<p id="sms-step-text">Оплатить быстрым платежом с помощью SMS по номеру мобильного телефона, привязанному к wmid:</p>'+
'<div class="gray-corners corners"><div class="webmoney_data_status">'+
'<div id="webmoney-step-1"><h3>Укажите номер телефона или e-mail</h3>'+
'<div><span class="ext-input-wrap"><input class="ext-input" name="webmoney-client" id="webmoney-client"/></span>'+
'<button class="coolbtn btn-green-18" type="submit" onclick="WebMoney_OneClick_StepOne();"><u></u>Продолжить<s></s></button></div>'+
'<div class="op-data"><p>На ваш телефон будет отправлено SMS с числовым кодом подтверждения. У wmid, с которого производится платеж, должна быть подключена <a href="https://wiki.webmoney.ru/projects/webmoney/wiki/%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D0%BF%D1%86%D0%B8%D0%B8_%D0%BE%D0%BF%D0%BB%D0%B0%D1%82%D1%8B_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_SMS">опция оплаты с помощью SMS</a>, сделать это можно на сайте Сервиса безопасности.</p></div></div>'+
'<div id="webmoney-step-2" style="display:none;"><input id="card-orderid" type="hidden"><h3>Ввведите числовой код из SMS</h3>'+
'<div class="multiple-blocks"><span class="ext-input-wrap"><input class="ext-input inum" name="webmoney-code" id="webmoney-code"/></span>'+
'<button class="coolbtn btn-green-18" type="submit" onclick="WebMoney_OneClick_StepTwo();"><u></u>Завершить платеж<s></s></button></div>'+
'<div class="op-data"><p>Взимается дополнительная фиксированная комиссия в размере 0,9 WMR, 0,04 WMZ, 0,03 WME, 0,25 WMU, в зависимости от валюты платежа.</p></div></div>'+
'<div id="card-progress" style="display:none"><p>Идет обработка платежа</p></div>'+
'</div></div>'+
'<div class="webmoney-link"><a href="javascript:void(0);" id="webmoney-link">Оплатить через стандартный интерфейс WebMoney</a></div>'
);$('.anonym-webmoney-buy').slideDown(200);});return false;}
$('#webmoney-step-1 #webmoney-client').live('keypress',function(e){if(e.keyCode==13){$('#webmoney-step-1 button').trigger('click');return false;}});$('#webmoney-step-2 #webmoney-code').live('keypress',function(e){if(e.keyCode==13){$('#webmoney-step-2 button').trigger('click');return false;}});function WebMoney_OneClick_StepOne(){var form_err='';var cardnum=$('#webmoney-client').val();if(!cardnum.length){form_err+="- Не введен телефон или e-mail карты\n";MarkRegField(__el('webmoney-client'));$('#webmoney-client').focus();}else{UnMarkRegField(__el('webmoney-client'));}
if(form_err!=''){alert(form_err);return false;}
WebMoney_OneClick_Overlay_Show();var sum=$('#purchase_price').attr('value');GUJ.PutRequest({url:'/pages/webmoney_payment_init/',Method:'POST',params:{'sum':sum,'client':cardnum},OnData:function(data){if(data.result!="ok"){WebMoney_OneClick_Overlay_Close(1);alert(data.message);return false;}
$('#card-orderid').val(data.oid);wm_ref_url='/pages/my_books/?action=create_custom_set&arts='+$('#a_buybtn_webmoney').parent().find('input[name=arts]').val()+'&buy_now=1';WebMoney_OneClick_AutoCheck_Start();}});}
function WebMoney_OneClick_AutoCheck_Start(){WMIntervalID=setInterval("WebMoney_OneClick_AutoCheck()",5000);}
function WebMoney_OneClick_AutoCheck_Stop(){clearInterval(WMIntervalID);}
function WebMoney_OneClick_AutoCheck(){var request={url:'/pages/webmoney_payment_check/',Method:'POST',OnData:function(data){if(data.result=="ok"){$('#webmoney-code').focus();WebMoney_OneClick_Overlay_Close(2);WebMoney_OneClick_AutoCheck_Stop();}else if(data.result=="error"){WebMoney_OneClick_Overlay_Close(1);alert(data.message);WebMoney_OneClick_AutoCheck_Stop();return false;}else if($('#card-progress p').text()!=data.message){$('#card-progress p').html(data.message);}}}
request.params={'order':$('#card-orderid').val()}
GUJ.PutRequest(request);return false;}
function WebMoney_OneClick_StepTwo(){if(!$('#webmoney-code').val().length){alert("- Не введен код подтверждения\n");MarkRegField(__el('webmoney-code'));$('#webmoney-code').focus();return false;}else{UnMarkRegField(__el('webmoney-code'));}
WebMoney_OneClick_Overlay_Show();GUJ.PutRequest({url:'/pages/webmoney_payment_check/',Method:'POST',params:{'order':$('#card-orderid').val(),'code':$('#webmoney-code').val()},OnData:function(data){if(data.result=="ok"){CheckMoneyStart();}else if(data.result=="error"){$('.anonym-webmoney-buy').slideDown(200);alert(data.message);return false;}
}});return false;}
function WebMoney_OneClick_Overlay_Show(){$('#webmoney-step-1').hide();$('#webmoney-step-2').hide();$('#card-progress').show();}
function WebMoney_OneClick_Overlay_Close(step){$('#webmoney-step-'+step).show();$('#card-progress').hide();}
function CheckMoneyStart(){CheckMoneyIntID=setInterval("CheckMoney()",5000);}
function CheckMoneyStop(){clearInterval(CheckMoneyIntID);}
function CheckMoney(){var request={url:'/pages/sms_check/',Method:'POST',HttpRType:'json',OnData:function(data){if(getCookie('last_autoread')&&getCookie('last_autoread')=='')return;if(data.status=="ok"){CheckMoneyStop();setCookie('last_autoread','',1,'/');document.location=wm_ref_url;}else if(data.status=="error"){CheckMoneyStop();WebMoney_OneClick_Overlay_Close(2);if(data.msg)alert(data.msg);}}}
request.params={'order_id':$('#card-orderid').val()}
GUJ.PutRequest(request);return false;}
function ShowRegPopup(){$("#login-bubble").data("overlay").load();$('#login-bubble').addClass('quick-reg');$(".registration").css('visibility','inherit');$('#frm_quick_login').css('visibility','hidden');$("#div-quick-login").hide();$("#div-quick-reg").show();$("#login-bubble").data("overlay").load();$('#quick_regform #new_login').focus();}
var ContactOK=undefined;var FBOk=undefined;function popup_social(){var container='#soc_group';if($(container).html())return true;var node='#download_file_popup';$(node).overlay({fixed:false,speed:100,load:false,onClose:function(){$.mask.close();GUJ.PutRequest({url:'/pages/ajax_epmty/',params:{action:'set_socnet_reminder',rand:Math.random()}});},onLoad:function(){$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$(node).overlay().close();}});}});function CkeckAllDoneAndGo(){if(FBOk==undefined||ContactOK==undefined)return false;if(FBOk==0&&ContactOK!=1){$(node).overlay().load();$(container).html('<noindex><iframe src="//www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2Fmylitres&amp;width=518&amp;colorscheme=light&amp;show_faces=true&amp;border_color&amp;stream=false&amp;header=true&amp;height=290" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:518px; height:290px;" allowTransparency="true"></iframe></noindex>');}else if(FBOk!=1&&ContactOK==0){$(node).overlay().load();$(container).html('<div id="vk_groups2"></div>');VK.Widgets.Group("vk_groups2",{mode:0,width:"518",height:"290"},23482323);}}
CheckSNGroups(CkeckAllDoneAndGo);return true;}
function CheckSNGroups(f){if(getCookie('ingroup_vk')){ContactOK=getCookie('ingroup_vk');if(typeof f=='function')f();}else{try{VK.api('groups.isMember',{gid:23482323},function(k){if(k==undefined){ContactOK=-1;}else{ContactOK=k.response==undefined?-1:k.response;setCookie('ingroup_vk',ContactOK,0,'/',2);}
if(typeof f=='function')f();});}catch(e){ContactOK=-1;if(typeof f=='function')f();}}
if(getCookie('ingroup_fb')){FBOk=getCookie('ingroup_fb');if(typeof f=='function')f();}else{if(FB.getAuthResponse()!=null){FB.api({method:'pages.isFan',page_id:'mylitres'},function(k){FBOk=k==undefined?-1:k==1?1:0;FBOk_out=k.error_code;if(FBOk_out==104)FBOk=-1;setCookie('ingroup_fb',FBOk,0,'/',2);if(typeof f=='function')f();});}else{FBOk=-1;if(typeof f=='function')f();}}}
jQuery.fn.placeholder=function(){$(this)
.focusout(function(){if(this.value=='')this.value=$(this).attr('placeholder');if(this.value==$(this).attr('placeholder'))
$(this).addClass('def_txt');else $(this).removeClass('def_txt');})
.focus(function(event){event.stopImmediatePropagation();if(this.value==$(this).attr('placeholder')){$(this).val('').removeClass('def_txt');}})
.mousedown(function(){$(this).focus();})
.triggerHandler('focusout');}
function NewOpenPassToggle(prefix){var passopen=$('#show_pass'+prefix).is(':checked');var opwf=$('#open_pwd'+prefix+'_inp');var cpwf=$('#pwd'+prefix+'_inp');var cpwp=$('#pwd2'+prefix+'_inp');if(passopen){opwf.val(cpwf.val());opwf.triggerHandler('focusout');}else{var value=(!placeholders_supported&&opwf.val()==opwf.attr('placeholder'))?'':opwf.val();cpwf.val(opwf.val());cpwp.val(opwf.val());}
$('#open_pwd'+prefix).css('display',passopen?'block':'none');$('#pwd'+prefix).css('display',passopen?'none':'block');}
var bubbleInterval;var bubbleTimeout;var bubbleIndex=null;$(document).ready(function(){$('#hg-overlay, #hg-pop_close').click(function(){$("#hg-pop-tooltip").hide();$('.dwnl_splr_btn_active').removeClass('dwnl_splr_btn_active');$('#hg-pop-tooltip').removeClass('free_book_get');$('#hg-overlay').hide();$('#hg-content:not(.langs)').html(' ');$('#hg-t, #hg-t > i, #hg-t > i > b').removeAttr("style");if($('.new-book-over-cover .download-links .formats a').length>0)
$('.new-book-over-cover .download-links .formats a').removeClass('clicked')});$('#multi_card_calc').on('keyup','.quantity',function(){var quantity=+$(this).val();var total=$('#total');if(quantity<100){total.text(0);}else if(quantity>=100&&quantity<=299){total.text(Math.floor(quantity*0.25));}else if(quantity>=300&&quantity<=499){total.text(Math.floor(quantity*0.30));}else if(quantity>=500&&quantity<=699){total.text(Math.floor(quantity*0.35));}else if(quantity>=700&&quantity<=999){total.text(Math.floor(quantity*0.40));}else{total.text(Math.floor(quantity*0.50));}});var book_author_list=$('.book-author .h2');if(book_author_list.length&&book_author_list.height()>65){book_author_list.delay(500).addClass('book-author-closed').after('<div class="transp_footer"><span>Показать всех авторов</span></div>');$('.transp_footer').on('click',function(){var t=$(this);if(t.prev().height()>65){t.prev().addClass('book-author-closed').next().removeClass('t_on').find('span').text('Показать всех авторов');}else{t.prev().removeClass('book-author-closed').next().addClass('t_on').find('span').text('Свернуть авторов');}});}});function getAssocArrayLength(tempArray){var result=0;for(tempValue in tempArray)result++;return result;}
function popup_download_type(obj,art,fid,filename,sid,formats,z_index,url_path){if(!formats.length){return true;}
var format_names={"fb2.zip":"FB2","epub":"EPUB","ios.epub":"IOS.EPUB","txt.zip":"TXT.ZIP","rtf.zip":"RTF","a4.pdf":"PDF A4","html.zip":"HTML.ZIP","a6.pdf":"PDF A6","mobi.prc":"MOBI","txt":"TXT","java":"JAVA","lrf":"LRF"};var format_subnames={"mobi.prc":" (Kindle)","lrf":" (Sony)"};var tmp="";var drm;var arr={1:[],2:[],3:[],4:[],5:[]};for(var i=0;i<formats.length;i++){if(formats[i]=='fb2.zip'||formats[i]=='epub'||(!url_path&&formats[i]=='ios.epub'))
arr[1][arr[1].length]=formats[i];if(formats[i]=='a6.pdf'||(!url_path&&formats[i]=='mobi.prc'))
arr[2][arr[2].length]=formats[i];if(!url_path&&formats[i]=='lrf')
arr[3][arr[3].length]=formats[i];if(formats[i]=='txt.zip'||formats[i]=='rtf.zip'||formats[i]=='a4.pdf'||(!url_path&&formats[i]=='html.zip'))
arr[4][arr[4].length]=formats[i];if(!url_path&&formats[i]=='txt'){arr[5][arr[5].length]=formats[i];arr[5][arr[5].length]='java';}
if(formats[i]=='drm'){drm=1;}}
for(var i=1;i<=getAssocArrayLength(arr);i++){if(getAssocArrayLength(arr[i])>0){tmp2=arr[i];if(i==1)tmp+='<ul class="pdt1"><li class="title">Удобные</li>';if(i==2)tmp+='<ul class="pdt2"><li class="title">Для ридеров</li>';if(i==3)tmp+='<ul class="pdt3"><li class="title">Другие</li>';if(i==4)tmp+='<ul class="pdt4"><li class="title">Для компьютера</li>';if(i==5)tmp+='<ul class="pdt5"><li class="title">Для телефона</li>';for(var g=0;g<tmp2.length;g++){if(tmp2[g]=='java'){tmp+='<li><a href="/pages/make_java/?file='+fid+'">'+format_names[tmp2[g]]+'</a>';}else{tmp+='<li><a href="';if(url_path){tmp+=url_path;}else{tmp+='/download_book/'+art+'/'+fid+'/'+filename;}
if(tmp2[g]=='fb2.zip'){tmp+='.new';}
tmp+='.'+tmp2[g]+'?sid='+sid;if(url_path){tmp+='&from=litres_frag';}
tmp+='&track=from_mybook_header__mainpopup">'+
format_names[tmp2[g]]+'</a>'+
(format_subnames[tmp2[g]]?format_subnames[tmp2[g]]:"");}
if(drm){tmp+='<span style="color:#dd3d0e;"> (защищено DRM)</span>';}
tmp+='</li>';}
tmp+='</ul>';}}
$("#hg-content").html('<div class="pdt-content">'+tmp+'</div>');HGContentPos(obj);if(z_index)$('.hint-gray,#hg-overlay').css({'z-index':9999});else{$('.hint-gray').css({'z-index':1010});$('#hg-overlay').css({'z-index':11});}
$('.dwnl_splr_btn').removeClass('dwnl_splr_btn_active');$(obj).addClass('dwnl_splr_btn_active');}
function HGContentPos(obj){var offleft=$(obj).offset().left,ttip=$("#hg-pop-tooltip"),ttip_width=ttip.width(),body=$("body").width(),pd=offleft+ttip_width;$('#hg-pop-tooltip, #hg-pop_close, #hg-overlay').show();if(pd>=body)
ttip.css({left:body-ttip_width-30,top:$(obj).offset().top+20});else{ttip.css({left:offleft-30,top:$(obj).offset().top+20});}
var left_width=$(obj).offset().left-ttip.offset().left+$(obj).width()/2+16;ttip.find("#hg-t").css({marginLeft:left_width,width:ttip_width-left_width});ttip.find("#hg-t i").css({width:left_width,left:-left_width});ttip.find("#hg-t b").css({width:left_width-44});}
function setBubbleCloseTO(){bubbleTimeout=setTimeout(function(){clearTimeout(bubbleTimeout);if(bubbleIndex!=null){$("#top_bubble_area .top_bubble .top_bubble_close").eq(bubbleIndex).click();}},3000);}
function LoginFormCheck(the_form){if(the_form&&the_form.id=='frm_login'){AppendUtcOffsetInput2Form('frm_login');return true;}else{var pageUrl=window.location.href;var paramsMatch=pageUrl.match(/([^?]+)\?(.+)/);if(paramsMatch!=null){pageUrl=paramsMatch[1];var getParams=paramsMatch[2].split('&');$(getParams).each(function(idx,val){var params=val.split('=');var decodedParamName=decodeURI(params[0]);var decodedParamVal=decodeURI(params[1]);if(decodedParamVal.length&&!$('#frm_quick_login input[name='+decodedParamName+']').length)
$('#frm_quick_login').append('<input type="hidden" name="'+decodedParamName+'" value="'+decodedParamVal+'" />');});}
document.forms.frm_quick_login.action=pageUrl;AppendUtcOffsetInput2Form('frm_quick_login');};if($('#login_fast_inp').val()==''||(!placeholders_supported&&$('#login_fast_inp').val()==$('#login_fast_inp').attr('placeholder'))){$("#loginfailblock span").text('Введите логин и пароль');$("#loginfailblock").show();$('#login_fast_inp').removeClass('def_txt').focus();return false;}
var el=$('#'+($('#show_pass_fast').is(":checked")?'open_':'')+'pwd_fast input');if(el.val()==''||(!placeholders_supported&&el.val()==el.attr('placeholder'))){el.removeClass('def_txt').focus();return false;}
return true;}
function PutMoneyBasketAddArt(Obj,Summ){var CMess='На вашем счете недостаточно средств для покупки, не хватает '+RubPrice(Summ)+' <span class="litres_ruble">&#8381;</span>\nХотите отложить книгу и пополнить счет сейчас?';var CFunc=function exec(){if(Summ<10)Summ=10;window.location.href='/pages/put_money_on_account/?summ='+RubPrice(Summ)+'&ref_url='+encodeURIComponent(Obj.getAttribute('href'));};alertBox.errorStickerButtons[0].value='OK';alertBox.alert(CMess,CFunc);return false;}
var AJAXOFF=0;var RootStarted=0;function PutArtToBasketAjax(ArtID,AddPrice,Type,Delivered){if(AJAXOFF||RootStarted||((Type===0||Type===4||Type===1)&&typeof third_book_free!='undefined'&&third_book_free>0)){return true;}
var Mode='root';RootStarted=1;if($('#fast_basket_spl').length>0){Mode='child';RootStarted=0;}else if($('#right_col_private').length>0){Mode='semiroot';}
var ab_header=$('.ab-header');var ToBasAjaxRequest={url:'/pages/ajax_tobasket/'+(ab_header.length?'?newcap':''),params:{art:ArtID,mode:Mode,action:'add_art_to_basket'},OnHTML:function(HTML){var TargetElement=$('#fast_basket_spl');if(this.params.mode=='semiroot'){TargetElement=$('#right_col_private');}else if(this.params.mode=='root'){TargetElement=$('#right_content_cell');}
TargetElement.prepend(HTML);var ElToSlide=0;if(this.params.mode=='root'){ElToSlide='right_col_private';}else if(this.params.mode=='semiroot'){ElToSlide='fast_basket_block';}
if(ElToSlide){$('#'+ElToSlide).hide();$('#'+ElToSlide).slideDown('fast').addClass('gray-corners').addClass('corners');if($('#last_views').length>0){$('#last_views').before("<hr class='right_col_hr'/>");}}
var basket_items=$('div[id^="basketitem_"]').length;$('#fast_basket_spl_title_num').html('('+basket_items+')');$('.header_basket_spl_title_num').html(basket_items+' '+decOfNum(basket_items,['товар','товара','товаров']));if(ab_header.length){ab_header.find($('.ab-header_basket_spl_title_num')).html(basket_items);if(basket_items==1){ab_header.find('.basket_not_empty').show();ab_header.find('.basket_empty').hide();}
if(basket_items==5){$('#fast_basket_spl').addClass('scrollbar');scrollbar_basket=new scrollbar($('#fast_basket_spl.scrollbar')[0],{show:true});}
var basket_items_giftbook=$('div[id^="basketitem_"][data-giftbook]').length;CheckBookGift(basket_items_giftbook,Type);}
if(this.params.mode=='child'){$('#total_qbasket_summ').html(RubPrice(DerubPrice('total_qbasket_summ')+this.AddPrice));}
MailTarAddCart();$('*[class~="tobasket_'+this.ArtID+'_out"]').show();$('*[class^="tobasket1_'+this.ArtID+'"]').remove();if($('*[class~="in_basket_quality_'+this.ArtID+'"]').length){Paper_Book_Basket(this.ArtID,1);}
RootStarted=0;if(Delivered==1)ToBasElems.show();if((Type===0||Type===4||Type===1)&&typeof third_book_free!='undefined')third_book_free++;},OnHTMLFail:function(fake1,fake2){AJAXOFF=1;if(fake2.AnonErrMsg){alert(fake2.AnonErrMsg);}else{alert('Ошибка при добавлении книги в корзину. Попробуйте, пожалуйста, добавить эту книгу в корзину еще раз');}
$('*[class~="tobasket1_'+this.ArtID+'"]').remove();this.ToBasElems().show();},ArtID:ArtID,AddPrice:AddPrice,ToBasElems:function(){return $('*[class~="tobasket_'+this.ArtID+'_in"]')}};var ToBasElems=ToBasAjaxRequest.ToBasElems();ToBasElems.before('<img alt="" src="/static/new/i/ajax_progress.gif" class="tobasket1_'+ArtID+' progress_gif" width="16" height="16" style="position: relative;"/>');ToBasElems.hide();GUJ.PutRequest(ToBasAjaxRequest);try{event.returnValue=false}catch(e){return false};}
function DropArtFromBasketAjax(BasketID,PriceToDecr,ArtID,Type){if(AJAXOFF||((Type===0||Type===4||Type===1)&&typeof third_book_free!='undefined')){return true;}
var Request={url:'/pages/ajax_epmty/',params:{action:'del_art_from_basket',itm:BasketID},BasketID:BasketID,PriceToDecr:PriceToDecr,OnData:function(Data){if(Data==='ok'){var basket_items=$('div[id^="basketitem_"]').length-1;$('#fast_basket_spl_title_num').html('('+basket_items+')');$('.header_basket_spl_title_num').html(basket_items+' '+decOfNum(basket_items,['товар','товара','товаров']));var ab_header=$('.ab-header');if(ab_header.length){ab_header.find($('.ab-header_basket_spl_title_num')).html(basket_items);if(!basket_items){ab_header.find('.basket_not_empty').hide();ab_header.find('.basket_empty').show();ab_header.find('.ab-userinfo > ul > li.basket').removeClass('active');}
if(basket_items==4){$('#fast_basket_spl').addClass('scrollbar');scrollbar_basket.Destroy();}
var basket_items_giftbook=$('div[id^="basketitem_"][data-giftbook]').length-1;CheckBookGift(basket_items_giftbook,Type);}
$('#total_qbasket_summ').html(RubPrice(DerubPrice('total_qbasket_summ')-this.PriceToDecr));$('#basketitem_'+this.BasketID).slideUp('fast',function(){$(this).remove();if($('div[id^="basketitem_"]').length==0){$('#fast_basket_block').remove();if($('#right_col_hr_divider').length==0)$('.right_col_hr').remove();if($('#right_col_hr_divider').length==0&&$('#last_views').length==0){$('#right_col_private').remove();}
else{$('#right_col_hr_divider').remove();}}else if($('#fast_basket_hided_link_d').length>0&&$('div[id^="basketitem_"]').length-$('#fast_basket_hided div[id^="basketitem_"]').length<3){OpenFastBasketSpoiler();$('#fast_basket_hided_link_d').remove();}});$('*[class~="tobasket_'+this.ArtID+'_in"]').show();$('*[class~="tobasket_'+this.ArtID+'_out"]').hide();if($('*[class~="in_basket_quality_'+this.ArtID+'"]').length){Paper_Book_Basket(this.ArtID);}}else{this.OnDataFail(0,0);}},ArtID:ArtID,OnDataFail:function(fake1,fake2){AJAXOFF=1;alert('При удалении из корзины произошла ошибка. Попробуйте, пожалуйста, удалить товар из корзины еще раз');$('#frombasket_'+this.BasketID).remove();}}
$('#basketitem_'+BasketID+' .del_item_btn').prepend('<span class="progress"><img alt="" src="/static/new/i/ajax_progress.gif" id="frombasket_'+BasketID+'" class="frombasket_'+BasketID+' rm_progress_gif" width="16" height="16"/></span>');GUJ.PutRequest(Request);try{event.returnValue=false}catch(e){return false};}
function DropMessage(mess_id){if(AJAXOFF)return true;var Request={url:'/pages/ajax_epmty/',params:{action:'communicator_killmsgs',box:104,items:mess_id},OnData:function(Data){if(Data==='ok'){$('#top_mess_'+mess_id).remove();var newcap=$('.ab-header');if(newcap.length){var mess=newcap.find('.ab-userinfo > ul > li.info'),mess_span=newcap.find('.ab-userinfo > ul > li.info > a > span'),mess_length=parseInt((mess_span).text())-1;mess_span.text(mess_length);if(mess_length==0){mess.remove();$('.ab-userinfo > ul').addClass('no_info');}}}else{$('#top_mess_'+mess_id+' .my-mess i').remove();alert(Data);}}}
GUJ.PutRequest(Request);$('#top_mess_'+mess_id+' .my-mess').prepend('<i class="mess-progress"></i>');return false;}
function DerubPrice(ElementID){var CurRubPrice=$('#'+ElementID).text();CurRubPrice=CurRubPrice.replace(',','.')*1;return CurRubPrice;}
function MailTarAddCart(){var _tmr=window._tmr||(window._tmr=[]);_tmr.push({id:"1283707",type:"reachGoal",goal:"cart"});}
var mhnns_cnt=0;var WorkingWidth=0;var WorkingWidth=0;var FixWidthOn=1600;function MakeHotNewNormalSize(){if(mhnns_cnt>0){mhnns_cnt=2;return;}
mhnns_TID=1;if(document.getElementById('main-div'))MainDivResize(false);if(document.getElementById('master_page_div')){AdoptInScreenBlocks();var HotNewDiv=document.getElementById('ratings');if(!HotNewDiv){return;}
var HeightLimit=document.getElementById('master_page_div').offsetHeight;if(HeightLimit<700)HeightLimit=700;var CropElementTo=FindFinalElement(HotNewDiv,HeightLimit-HotNewDiv.offsetTop);HotNewDiv.style.overflow='hidden';HotNewDiv.style.height=(CropElementTo+3)+'px';}
if(mhnns_cnt>1){mhnns_cnt=0;MakeHotNewNormalSize();}
mhnns_TID=0;}
function FindFinalElement(TopDiv,Limit){var CurPos=0;for(var i=0;i<TopDiv.childNodes.length&&CurPos<Limit;i++){var Child=TopDiv.childNodes[i];var ChildClass=Child.className+'';if(ChildClass.match(/right_col_title|extender/)){CurPos=Child.offsetTop;}else{CurPos=FindFinalElement(Child,Limit-CurPos);}}
return CurPos;}
var Padding=20;var BlockWidth=0;var TitleWidth=0;var BlockCSS;var TitleCSS1;var TitleCSS2;var MainDivCSS;var TopBubbleCSS;if(getCSSRule('.newbook')){BlockCSS=getCSSRule('.newbook').style;if(BlockCSS&&BlockCSS.width){BlockWidth=parseInt(BlockCSS.width)+Padding;}
TitleCSS1=getCSSRule('.newbook .booktitle').style;if(TitleCSS1&&TitleCSS1.width){TitleWidth=(TitleCSS1.width+'').replace('px','')*1;}
TitleCSS2=getCSSRule('.newbook .booksubtitle').style;}
if(getCSSRule('div#main-div')){MainDivCSS=getCSSRule('div#main-div').style;TopBubbleCSS=getCSSRule('.top_bubble').style;}
function AdoptInScreenBlocks(){if(no_adopt)return;if(BlockWidth){WorkingWidth=0;if(document.getElementById('master_page_div')){WorkingWidth=document.getElementById('master_page_div').offsetWidth;}else{var gpad=GetPadding();WorkingWidth=Math.min(document.body.clientWidth,FixWidthOn+22)
-gpad*2-208-22-32;if(WorkingWidth<351){WorkingWidth=351;}}
var BlocksPerLine=Math.floor(WorkingWidth/BlockWidth);var CanAddPixels=Math.floor((WorkingWidth-BlockWidth*BlocksPerLine)/BlocksPerLine);BlockCSS.width=(BlockWidth+CanAddPixels-Padding)+'px';if(TitleWidth+CanAddPixels>0)
TitleCSS2.width=TitleCSS1.width=(TitleWidth+CanAddPixels)+'px';}}
function FindMaxWH(all_elements){var el=all_elements.filter(":first");var maxH=el.parent().height();var maxW=el.parent().width();var text;var oldtext=el.attr('title')||el.html();var newtext="ЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖЖ";var real_max_w;var real_max_h;if(!el.length)return;el.html(newtext);var start=el.outerWidth()<maxW;do{text=newtext;if(start){newtext=newtext+"Ж";}else{newtext=newtext.substring(0,text.length-1);}
el.html(newtext);}while((el.outerWidth()<maxW)==start);real_max_w=text.length;real_max_h=0;newtext=text;do{text=newtext;real_max_h++;newtext=newtext+" "+newtext;el.html(newtext);}while(el.outerHeight()<maxH);el.html(oldtext);return{'maxH':maxH,'maxW':maxW,'real_max_h':real_max_h,'real_max_w':real_max_w};}
function MakeEllipsis(){var ellipsis_elements=new Array(jQuery(".ell_new").not(".ellE1, .ellA1, .ellT1, .no_ellipsis").find("a"),jQuery(".ellE1").not(".ellA1, .ellT1").find("a"));if(jQuery().ellipsis){for(var i=0;i<ellipsis_elements.length;i++){var all_elements=ellipsis_elements[i];var size=FindMaxWH(all_elements);if(size&&size.maxW&&size.maxH&&size.real_max_w&&size.real_max_h){all_elements.ellipsis(size.maxW,size.maxH,size.real_max_w,size.real_max_h);}}}
}
function GetPadding(){var gwidth=document.body.clientWidth;var gpad=(gwidth>=FixWidthOn)?50:5*(gwidth-980)/62;gpad=(gpad>0)?parseInt(gpad):0;return gpad;}
function MainDivResize(init){var gpad=GetPadding();var maxwidth=FixWidthOn-gpad*2;MainDivCSS.maxWidth=maxwidth+'px';MainDivCSS.paddingLeft=gpad+'px';MainDivCSS.paddingRight=gpad+'px';TopBubbleCSS.width=100-parseInt(gpad*3/5)+'%';if(!init&&$.browser.msie&&$.browser.version.substr(0,1)<7&&$("#main-div").width()>maxwidth){$("#main-div").width(maxwidth);}
$("#dynamics_padd").css("paddingLeft",MainDivCSS.paddingLeft);}
BodyEndFunc.push({'za_MHNNS':MakeHotNewNormalSize,'zb_ellipsis':MakeEllipsis});WinResizeFunc.push({'zz_resize_MHNNS':function(){MakeHotNewNormalSize();MakeEllipsis();}});BodyLoadFunc.push({'menuscroll':function(){var menuscroll=new SimpleScroller;},'za_HNNS':MakeHotNewNormalSize});var sfac_delay=false;var sfac_tdelay=false;var sfac_sel=-1;var sfac_pps;var sfac_timeout;var sfac_cache={};var sfac_ID=0;function sfac_init(){var inp=$("#q");inp
.keydown(function(e){if(e.keyCode==13&&document.getElementById("nspotlight").style.display!='none'&&!sfac_keyEvent(e.keyCode)){e.preventDefault();return false;}})
.keyup(function(e){if(e.keyCode==39||e.keyCode==37)return false;if((e.keyCode==38||e.keyCode==40)&&document.getElementById("nspotlight").style.display!='none'&&!sfac_keyEvent(e.keyCode)){e.preventDefault();return false;}
if(sfac_pps==undefined){sfac_request();}else sfac_delay=true;clearTimeout(sfac_pps);sfac_pps=setTimeout(function(){sfac_pps=undefined;if(sfac_delay)sfac_request();},50);})
.blur(function(){sfac_delay=false;sfac_tdelay=false;sfac_sel=-1;clearTimeout(sfac_pps);clearTimeout(sfac_timeout);setTimeout(function(){document.getElementById("nspotlight").style.display='none';},200);})
.focus(function(){if(inp.val().length>2||/^\d{2,}?$/.test(inp.val())){document.getElementById("nspotlight").style.display='block';if(sfac_pps==undefined){sfac_request();}else{sfac_delay=true;}
clearTimeout(sfac_pps);sfac_pps=setTimeout(function(){sfac_pps=undefined;if(sfac_delay)sfac_request();},50);}});$('<div id="sfac_cont" id="srch_popup"><div id="nspotlight" class="nspotlight"/></div>').insertAfter(inp);$('#s-sample').click(function(){inp.val($(this).text()).removeClass('def_txt').focus();sfac_request();});if(litres.tests.test261=='test'||litres.isNewSearch){var $go=$('#go');$go.prop("disabled","disabled");inp.on('keydown keyup blur focus',function(){if(/^[^!@№#$%^&*()\/?<>{}!+=;:_ -]{3,}/.test(inp.val())){$go.removeAttr('disabled');}else{$go.prop("disabled","disabled");}});}}
function sfac_request(value){sfac_delay=false;var artMemName={text:'Электронная книга',audio:'Аудиокнига',mmedia:'Аудиокнига',hardcopy:'Бумажная книга',english:'Электронная книга'};function isLat(val){return/^[\w\[\]\{\}\,\.\<\>\s\?\!]+$/.test(val);}
function sfac_onetower(obj){obj.toggleClass('nspotlight_small',obj.outerWidth(true)<500);obj.toggleClass('nspotlight_mid',obj.outerWidth(true)<800);}
function getImgPath(cover,no_photo){if(cover!=null)
return cover.replace(/https?:\/\/[-a-zA-Z0-9@:%._\+~#=]{1,256}\//g,'').replace('cover','cover_37').replace('.png','.jpg');return no_photo;}
var val=document.getElementById("q").value;if(sfac_timeout==undefined){sfac_tdelay=false;clearTimeout(sfac_timeout);if(val.length>2||/^\d{2,}?$/.test(val)){sfac_sel=-1;if(!window.QSRequestID){window.QSRequestID=1}else{window.QSRequestID++;}
var QSRequestID=window.QSRequestID;function spotLight(pobj){if(sfac_cache.hasOwnProperty(pobj.q)){renderSearchRows(sfac_cache[pobj.q],pobj);}else{if(sfac_ID){GUJ.CancelRequest(sfac_ID);}
sfac_ID=GUJ.PutRequest({url:'/pages/search_slice/',params:pobj,HttpRType:'json',QSRequestID:QSRequestID,OnData:function(data){if(this.QSRequestID!=window.QSRequestID){return;}
sfac_cache[val]=data;renderSearchRows(data,pobj);}});}}
spotLight({json:1,q:val,limit:9});sfac_timeout=setTimeout(function(){sfac_timeout=undefined;if(sfac_tdelay)sfac_request();},100);function renderSearchRows(data,pobj){var nspotlight=$('#nspotlight'),html_tmp='',out=$('<ul></ul>'),height=$.browser.webkit?document.documentElement.clientHeight:$(window).height(),currentType;height-=$('#sfac_cont').offset().top-$(document).scrollTop()-50;if(isLat(val)&&!data.result&&!pobj.t){return spotLight({json:1,q:val,limit:9,t:1});}
if(!data.result){return;}
function showRows(item){if(item.item_type==null||!item.item_type)return;if(!item.url&&item.id){switch(item.item_type){case'art':item.url='/pages/biblio_book/?art='+item.id;break;case'author':item.url='/pages/biblio_authors/?subject='+item.id;break;case'author':item.url='/pages/tags/?tag='+item.id;break;case'series':item.url='/pages/biblio_series/?id='+item.id;break;case'collections':item.url='/pages/biblio_collection/?collection='+item.id;break;case'copyright_page':item.url='/pages/izdatelstva/?izdatel='+item.id;break;}}
html_tmp='<li>'+
'<div data-link="'+item.url+'" class="nspotlight__item">'+
drawImage(item)+
drawTitle(item,data)+
drawButton(item,data)+
'</div>'+
'</li>';currentType=item.atype;out.append(html_tmp);}
for(var j=0;j<data.result.length;j++){showRows(data.result[j]);}
if(out.children().length){nspotlight.html('<ul class="nspotlight__items">'+out.html()+'</ul>');if(data.result.length>6){var searc_url=(litres.tests.test261=='test'||litres.isNewSearch)?'/pages/rmd_search/?q=':'/pages/biblio_search/?q=';nspotlight.find('ul').append('<li><div data-link="'+searc_url+val+'" class="nspotlight__item nspotlight__item_showall">'+
'<a class="nspotlight__showall" href="'+searc_url+val+'">Показать все результаты</a></div></li>');}
nspotlight.slideDown(200,function(){while(nspotlight.height()>height){nspotlight.find('ul').children().last().prev().remove();}});nspotlight.find('ul li').click(function(e){e=e||event;if($(e.target).is('a[href]')){window.location=$(e.target).attr('href');}else{window.location=$(this).find('div').data('link');}
return false;});nspotlight.find('ul li').on('hover',function(){$(this).add($(this).find('.spotitem')).toggleClass('hover');});$(window).resize(function(){sfac_onetower(nspotlight);});sfac_onetower(nspotlight);}
nspotlight.find('li.s').prev('li').find('div.spotitem').addClass('before_s_li');}
function drawImage(item){var html="";html+='<a title="'+item.title+'" href="'+item.url+'" class="nspotlight__img nspotlight__item_td">';if(item.arts){html+='<span class="nspotlight__cover_multiple">';for(var i=0;i<item.arts.length;i++){html+=drawCover({release_file:item.arts[i].release_file,cover:item.arts[i].cover,photo:item.arts[i].photo,id:item.arts[i].id,title:item.title,addClass:'nspotlight__cover_'+(i+1),ratio:item.arts[i].cover_ratio,type:item.item_type,mem:item.mem});}
html+='</span>';}else{html+=drawCover({release_file:item.release_file,cover:item.cover,photo:item.photo,id:item.id,title:item.title,ratio:item.cover_ratio,type:item.item_type,mem:item.mem});}
html+='</a>';return html;}
function drawCover(obj){var width=30;if(obj.type==='author'){width=50;obj.ratio=1;}
if(!obj.release_file&&!obj.cover&&!obj.photo){obj.release_file='//www.litres.ru/static/litres/i/';switch(obj.type){case'author':obj.release_file='//www.litres.ru/static/litres/i/header/search/no_img/author.svg';break;default:var mem;if(!!obj.mem){mem=obj.mem}else{mem='';}
if(mem=='text'){mem='';}
obj.release_file='//www.litres.ru/static/litres/i/cover/no_img/'+mem+'cover_30.png';}}else{if(obj.type=='author'){obj.release_file=drawCoverUrl(obj.id,width,obj.type,obj.photo);}else{obj.release_file=drawCoverUrl(obj.release_file,width,obj.type,obj.cover);}}
var height=width/obj.ratio;var html='<span'+
' class="nspotlight__cover'+' nspotlight__cover_'+obj.type+(obj.addClass?' '+obj.addClass:'')+'" '+
' style="'+
'background: url('+obj.release_file+') no-repeat center center;'+
'width:'+width+'px;'+
'height:'+height+'px;'+
'"'+
' title="'+obj.title+'"></span>';return html;}
function drawTitle(item,data){var FixedStr=data.search_string?data['search_string'].replace(/[еэё]/i,'[еэё]').replace(/[ий]/i,'[ий]'):'';var hint='';switch(item.item_type){case'author':hint='Автор';break;case'art':if(item.persons&&item.persons.person){var authors=$.grep(item.persons.person,function(n,i){return n.relation==0;});for(var i=0;i<authors.length;i++){hint+=authors[i].s_full_name;if(i==authors.length-1){hint+='.';}else if(i==authors.length-2){hint+=' и '}else{hint+=', ';}}}
if(artMemName[item.mem]){hint+=' '+artMemName[item.mem];}
break;case'tag':hint='Тег';break;case'serie':hint='Серия';break;case'collection':hint='Коллекция';break;case'genre':hint='Жанр';break;case'copyright_page':hint='Издательство';break;default:}
var className='nspotlight__title'+(item.owned?' nspotlight__title_purchased':'');var html='<div class="nspotlight__details nspotlight__item_td">'+
(hint?'<span class="nspotlight__hint">'+hint+'</span>':'')+
'<a href="'+item.url+'" title="'+item.title+'" class="'+className+'">'+
(isLat(val)?item.title:item.title.replace(new RegExp("("+FixedStr+")","gi"),"<b>$1</b>"))+
'</a>'+
'</div>';return html;}
function drawButton(item,data){var html=''
if(item.owned){var href;var text;switch(item.mem){case'audio':text='Слушать';href=item.url+'#play_now';break;case'text':if(item.percent){text='Продолжить чтение с '+Math.round(item.percent)+'%';}else{text='Читать';}
var itemType=item.type
if(itemType!==undefined){itemType=parseInt(item.type,10);}
switch(itemType){case 4:href='/static/or3/view/or.html?art_type=4&file='+item.file_id+'&bname='+encodeURIComponent(encodeURIComponent(item.title))+'&art='+item.id+'&user='+litres.user+'&uuid='+item.uuid+'&cover='+encodeURIComponent(item.img);break;default:href='/static/or4/view/or.html?baseurl=/download_book/'+item.id+'/'+item.release_file+'/&uuid='+item.uuid+'&art='+item.id+'&user='+litres_user_id;}
break;default:href=item.url;text='Читать';}
html='<div class="nspotlight__buttons nspotlight__item_td">'+
'<a href="'+href+'" class="nspotlight__read">'+text+'</a>'+
'</div>';}
return html;}}else{document.getElementById("nspotlight").style.display='none';}}else{sfac_tdelay=true;}}
function sfac_keyEvent(keyCode){var aList=$('#nspotlight li:not(.m, .s)');if(keyCode==13){if(sfac_sel==-1)return true;document.location.href=$(aList[sfac_sel]).find('a').attr('href');}
if((keyCode==38&&sfac_sel>=0)||(keyCode==40&&sfac_sel<aList.length-1)){for(i in aList){aList[i].className="";}
sfac_sel+=(keyCode==38?-1:1);if(sfac_sel>=0&&sfac_sel<aList.length)aList[sfac_sel].className="sfacSelected";}
return false;}
function drawCoverUrl(id,width,type,cover){var url="",releaseId="";var releaseFile=String(id);if(releaseFile.length<8){var i=0;while(i<8-releaseFile.length){releaseId+="0";i++;}}
releaseId+=releaseFile;var releaseIdTemp=releaseId.slice(0,2)+"/"+releaseId.slice(2,4)+"/"+releaseId.slice(4,6);var CoverDomain="cv"+releaseFile.substr(releaseFile.length-2,1);if(type=='author'){url="//litres.ru/static/authors/100/"+releaseIdTemp+"/"+releaseId+"_"+width+"."+cover+"";}else{url="https://"+CoverDomain+".litres.ru/static/bookimages/"+releaseIdTemp+"/"+releaseId+".bin.dir/"+releaseId+".cover_"+width+"."+cover+"";}
return url;}
var Paginator=function(paginatorHolderId,pagesTotal,pagesSpan,pageCurrent,baseUrl,moreSettings){if(!document.getElementById(paginatorHolderId)||!pagesTotal||!pagesSpan)return false;this.inputData={paginatorHolderId:paginatorHolderId,pagesTotal:pagesTotal,pagesSpanOrig:pagesSpan,pagesSpan:pagesSpan<pagesTotal?pagesSpan:pagesTotal,pageCurrent:pageCurrent,baseUrl:baseUrl?baseUrl:'/pages/',align:'justify',scrollBtn:'none',scrollBtnCaptionL:'«',scrollBtnCaptionR:'»'};for(var i in moreSettings){this.inputData[i]=moreSettings[i];}
if(pagesSpan>pagesTotal)this.inputData.scrollBtn='none';else this.inputData.align='justify';this.html={holder:null,table:null,trPages:null,trScrollBar:null,tdsPages:null,scrollBar:null,scrollThumb:null,pageCurrentMark:null};this.prepareHtml();this.initScrollThumb();this.initPageCurrentMark();this.initEvents();this.scrollToPageCurrent();}
Paginator.prototype.prepareHtml=function(){this.html.holder=document.getElementById(this.inputData.paginatorHolderId);this.html.holder.innerHTML=this.makePagesTableHtml();this.html.table=this.html.holder.getElementsByTagName('table')[0];var trPages=this.html.table.getElementsByTagName('tr')[0];this.html.tdsPages=new Array;this.html.skeepedTds=new Array;var tds=trPages.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].className.match(/scrollBtn/)){var tmp=tds[i].getElementsByTagName('a')[0];if(tmp.className.match(/scrollBtnL/))this.html.scrollBtnL=tds[i];else if(tmp.className.match(/scrollBtnR/))this.html.scrollBtnR=tds[i];continue;}
if(tds[i].style.visibility=='hidden'){this.html.skeepedTds.push(tds[i]);continue;}
this.html.tdsPages.push(tds[i]);}
this.html.scrollBar=getElementsByClassName(this.html.table,'div','scroll_bar')[0];this.html.scrollThumb=getElementsByClassName(this.html.table,'div','scroll_thumb')[0];this.html.pageCurrentMark=getElementsByClassName(this.html.table,'div','current_page_mark')[0];if(this.inputData.pagesSpan==this.inputData.pagesTotal){addClass(this.html.holder,'fullsize');}}
Paginator.prototype.makePagesTableHtml=function(){var tdWidth=(100/((this.inputData.align=='justify'?this.inputData.pagesSpan:this.inputData.pagesSpanOrig)+(this.inputData.scrollBtn.match(/left|right/)?1:this.inputData.scrollBtn=='both'?2:0)))+'%';var html=''+
'<table>'+
'<tr>'+
(this.inputData.align.match(/right|center/)?'<td style="visibility: hidden;"></td>':'')+
(this.inputData.scrollBtn.match(/left|both/)?'<td class="scrollBtn" width="'+tdWidth+'"><a href="#" class="scrollBtnL">'+this.inputData.scrollBtnCaptionL+'</a></td>':'');for(var i=1;i<=this.inputData.pagesSpan;i++){html+='<td width="'+tdWidth+'" class="paginator_cell"></td>';}
html+=''+
(this.inputData.scrollBtn.match(/right|both/)?'<td class="scrollBtn" width="'+tdWidth+'"><a href="#" class="scrollBtnR">'+this.inputData.scrollBtnCaptionR+'</a></td>':'')+
(this.inputData.align.match(/left|center/)?'<td style="visibility: hidden;"></td>':'')+
'</tr>'+
'<tr>'+
(this.inputData.align.match(/right|center/)?'<td style="visibility: hidden;"></td>':'')+
'<td colspan="'+(this.inputData.pagesSpan+
(this.inputData.scrollBtn.match(/left|right/)?1:this.inputData.scrollBtn=='both'?2:0))+'">'+
'<div class="scroll_bar">'+
'<div class="scroll_trough"></div>'+
'<div class="scroll_thumb">'+
'<div class="scroll_knob"></div>'+
'</div>'+
'<div class="current_page_mark"></div>'+
'</div>'+
'</td>'+
(this.inputData.align.match(/left|center/)?'<td style="visibility: hidden;"></td>':'')+
'</tr>'+
'</table>';return html;}
Paginator.prototype.initScrollThumb=function(){this.html.scrollThumb.widthMin='8';this.html.scrollThumb.widthPercent=this.inputData.pagesSpan/this.inputData.pagesTotal*100;this.html.scrollThumb.xPosPageCurrent=(this.inputData.pageCurrent-Math.round(this.inputData.pagesSpan/2))/this.inputData.pagesTotal*(this.html.table.offsetWidth-this.skeepWidth());this.html.scrollThumb.xPos=this.html.scrollThumb.xPosPageCurrent;this.html.scrollThumb.xPosMin=0;this.html.scrollThumb.xPosMax;this.html.scrollThumb.widthActual;this.setScrollThumbWidth();}
Paginator.prototype.skeepWidth=function(){var w=0;for(var i=0;i<this.html.skeepedTds.length;i++){w+=this.html.skeepedTds[i].offsetWidth;}
return w;}
Paginator.prototype.setScrollThumbWidth=function(){this.html.scrollThumb.style.width=this.html.scrollThumb.widthPercent+"%";this.html.scrollThumb.widthActual=this.html.scrollThumb.offsetWidth;if(this.html.scrollThumb.widthActual<this.html.scrollThumb.widthMin){this.html.scrollThumb.style.width=this.html.scrollThumb.widthMin+'px';}
this.html.scrollThumb.xPosMax=this.html.table.offsetWidth-this.skeepWidth()-this.html.scrollThumb.widthActual;}
Paginator.prototype.moveScrollThumb=function(){this.html.scrollThumb.style.left=this.html.scrollThumb.xPos+"px";}
Paginator.prototype.initPageCurrentMark=function(){this.html.pageCurrentMark.widthMin='3';this.html.pageCurrentMark.widthPercent=100/this.inputData.pagesTotal;this.html.pageCurrentMark.widthActual;this.setPageCurrentPointWidth();this.movePageCurrentPoint();}
Paginator.prototype.setPageCurrentPointWidth=function(){this.html.pageCurrentMark.style.width=this.html.pageCurrentMark.widthPercent+'%';this.html.pageCurrentMark.widthActual=this.html.pageCurrentMark.offsetWidth;if(this.html.pageCurrentMark.widthActual<this.html.pageCurrentMark.widthMin){this.html.pageCurrentMark.style.width=this.html.pageCurrentMark.widthMin+'px';}}
Paginator.prototype.movePageCurrentPoint=function(){if(this.html.pageCurrentMark.widthActual<this.html.pageCurrentMark.offsetWidth){this.html.pageCurrentMark.style.left=(this.inputData.pageCurrent-1)/this.inputData.pagesTotal*(this.html.table.offsetWidth-this.skeepWidth())-this.html.pageCurrentMark.offsetWidth/2+"px";}else{this.html.pageCurrentMark.style.left=(this.inputData.pageCurrent-1)/this.inputData.pagesTotal*(this.html.table.offsetWidth-this.skeepWidth())+"px";}}
Paginator.prototype.initEvents=function(){var _this=this;this.html.scrollThumb.onmousedown=function(e){if(!e)var e=window.event;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();var dx=getMousePosition(e).x-this.xPos;document.onmousemove=function(e){if(!e)var e=window.event;_this.html.scrollThumb.xPos=getMousePosition(e).x-dx;_this.moveScrollThumb();_this.drawPages();}
document.onmouseup=function(){document.onmousemove=null;_this.enableSelection();}
_this.disableSelection();}
this.html.scrollBar.onmousedown=function(e){if(!e)var e=window.event;if(matchClass(_this.paginatorBox,'fullsize'))return;_this.html.scrollThumb.xPos=getMousePosition(e).x-getPageX(_this.html.scrollBar)-_this.html.scrollThumb.offsetWidth/2;_this.moveScrollThumb();_this.drawPages();}
if(this.html.scrollBtnL){this.html.scrollBtnL.getElementsByTagName('a')[0].onclick=function(){_this.html.scrollThumb.xPos-=((_this.html.table.offsetWidth-_this.skeepWidth())/
_this.inputData.pagesTotal*(_this.inputData.pagesSpan));_this.moveScrollThumb();_this.drawPages();return false;}}
if(this.html.scrollBtnR){this.html.scrollBtnR.getElementsByTagName('a')[0].onclick=function(){_this.html.scrollThumb.xPos+=(_this.html.scrollThumb.xPos==0?2:0)+
((_this.html.table.offsetWidth-_this.skeepWidth())/
_this.inputData.pagesTotal*(_this.inputData.pagesSpan));_this.moveScrollThumb();_this.drawPages();return false;}}
WinResizeFunc.push({'resizePaginator':function(){Paginator.resizePaginator(_this);}});}
Paginator.prototype.drawPages=function(){var percentFromLeft=this.html.scrollThumb.xPos/(this.html.table.offsetWidth-this.skeepWidth());var cellFirstValue=Math.round(percentFromLeft*this.inputData.pagesTotal);var html="";if(cellFirstValue<1){cellFirstValue=1;this.html.scrollThumb.xPos=0;this.moveScrollThumb();}else if(cellFirstValue>=this.inputData.pagesTotal-this.inputData.pagesSpan){cellFirstValue=this.inputData.pagesTotal-this.inputData.pagesSpan+1;this.html.scrollThumb.xPos=this.html.table.offsetWidth-this.skeepWidth()-this.html.scrollThumb.offsetWidth;this.moveScrollThumb();}
if(this.html.scrollBtnL){if(cellFirstValue==1){if(this.html.scrollBtnL&&!this.html.scrollBtnL.className.match(/\s*disable/i))
this.html.scrollBtnL.className+=' disable';}else this.html.scrollBtnL.className=this.html.scrollBtnL.className.replace(/\s*disable/gi,'');}
if(this.html.scrollBtnR){if(cellFirstValue==this.inputData.pagesTotal-this.inputData.pagesSpan+1){if(this.html.scrollBtnR&&!this.html.scrollBtnR.className.match(/\s*disable/i))
this.html.scrollBtnR.className+=' disable';}else this.html.scrollBtnR.className=this.html.scrollBtnR.className.replace(/\s*disable/gi,'');}
for(var i=0;i<this.html.tdsPages.length;i++){var cellCurrentValue=cellFirstValue+i;if(cellCurrentValue==this.inputData.pageCurrent){html="<span><span class='line'></span>"+"<strong>"+cellCurrentValue+"</strong>"+"</span>";}else{var Url=this.inputData.baseUrl;if(cellCurrentValue==1){Url=Url.replace(/(?:\&?pagenum=current_page|\/page\-current_page)/,'')
Url=Url.replace(/limit=\d+&?/,"")
Url=Url.replace(/(\?|&)$/,"")}
html="<span>"+"<a href='"+Url.replace("current_page",cellCurrentValue)+"'>"+cellCurrentValue+"</a>"+"</span>";}
this.html.tdsPages[i].innerHTML=html;}}
Paginator.prototype.scrollToPageCurrent=function(){this.html.scrollThumb.xPosPageCurrent=(this.inputData.pageCurrent-Math.round(this.inputData.pagesSpan/2))/this.inputData.pagesTotal*(this.html.table.offsetWidth-this.skeepWidth());this.html.scrollThumb.xPos=this.html.scrollThumb.xPosPageCurrent;this.moveScrollThumb();this.drawPages();}
Paginator.prototype.disableSelection=function(){document.onselectstart=function(){return false;}
this.html.scrollThumb.focus();}
Paginator.prototype.enableSelection=function(){document.onselectstart=function(){return true;}}
Paginator.resizePaginator=function(paginatorObj){paginatorObj.setPageCurrentPointWidth();paginatorObj.movePageCurrentPoint();paginatorObj.setScrollThumbWidth();paginatorObj.scrollToPageCurrent();}
function getElementsByClassName(objParentNode,strNodeName,strClassName){var nodes=objParentNode.getElementsByTagName(strNodeName);if(!strClassName){return nodes;}
var nodesWithClassName=[];for(var i=0;i<nodes.length;i++){if(matchClass(nodes[i],strClassName)){nodesWithClassName[nodesWithClassName.length]=nodes[i];}}
return nodesWithClassName;}
function addEvent(objElement,strEventType,ptrEventFunc){if(objElement.addEventListener)
objElement.addEventListener(strEventType,ptrEventFunc,false);else if(objElement.attachEvent)
objElement.attachEvent('on'+strEventType,ptrEventFunc);}
function removeEvent(objElement,strEventType,ptrEventFunc){if(objElement.removeEventListener)objElement.removeEventListener(strEventType,ptrEventFunc,false);else if(objElement.detachEvent)objElement.detachEvent('on'+strEventType,ptrEventFunc);}
function getPageY(oElement){var iPosY=oElement.offsetTop;while(oElement.offsetParent!=null){oElement=oElement.offsetParent;iPosY+=oElement.offsetTop;if(oElement.tagName=='BODY')break;}
return iPosY;}
function getPageX(oElement){var iPosX=oElement.offsetLeft;while(oElement.offsetParent!=null){oElement=oElement.offsetParent;iPosX+=oElement.offsetLeft;if(oElement.tagName=='BODY')break;}
return iPosX;}
function getMousePosition(e){if(e.pageX||e.pageY){var posX=e.pageX;var posY=e.pageY;}else if(e.clientX||e.clientY){var posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;var posY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}
return{x:posX,y:posY}}
jQuery.fn.ellipsis=function(maxW,maxH,orig_max_w,real_max_h,start){return this.each(function(){var el=$(this);var title=el.attr('data-title');var mH=maxH||parseInt(el.parent().css('maxHeight'));if(!mH||mH<=0)mH=el.parent().height();var mW=maxW||parseInt(el.parent().css('maxWidth'));if(!mW||mW<=0)mW=el.parent().width();var oT=title||el.text();if(!title){el.not('.nott').attr('data-title',oT);}else el.text(oT);var ch=oT.length;var s=start||parseInt(ch/2);if(ch<orig_max_w){el.removeAttr('data-title');return;}
var real_max_w=Math.round(orig_max_w/0.65);var words=oT.split(/[ -]/);var curr_line=0;var line_length=0;var total_length=0;var need_dots=0;var i=0;while(curr_line<real_max_h&&i<words.length){var w_len=words[i].length;if(w_len>=real_max_w){total_length+=real_max_w+1;break;}else if(line_length+w_len>real_max_w){curr_line++;if(curr_line<real_max_h){total_length+=w_len+1;line_length=w_len+1;}else{total_length+=real_max_w+1-line_length;}}else{total_length+=w_len+1;line_length+=w_len+1;}
i++;}
if(total_length<ch){oT=oT.substring(0,total_length-2);oT=oT.replace(/[ -\:\,\.]+$/,"");oT+="…";}
var first_try=1;ch=oT.length;s=ch/2;el.text(oT);var nT=oT;while(s>1){el.text(nT);var oH=el.outerHeight(),oW=el.outerWidth();if(oH<=mH&&oW<=mW){if(first_try){s=0;}else if(oT.length==nT.length){s=0;}else{ch+=s;nT=oT.substring(0,ch);}}else{ch-=s;nT=nT.substring(0,ch);}
s=parseInt(s/2);first_try=0;}
if(oT.length>nT.length){nT=nT.substring(0,nT.length-2);el.text(nT+"…");}else if(!!el.attr('data-title')&&el.attr('data-title').length==nT.length){el.removeAttr('data-title');}});};function RusMonth(k){var month=[];month[0]="января";month[1]="февраля";month[2]="марта";month[3]="апреля";month[4]="мая";month[5]="июня";month[6]="июля";month[7]="августа";month[8]="сентября";month[9]="октября";month[10]="ноября";month[11]="декабря";return month[k];}
function recense_vote(is_good){var button_parent=$(this).parent();button_parent.html("<img src='/static/new/i/ajax_progress.gif'>");GUJ.PutRequest({url:'/pages/ajax_epmty/',params:{'rec_id':$(this).attr("data-id"),'is_good':is_good,'action':'recense_vote'},OnData:function(data){if(data!="ok"){alert("Ошибка: "+data[0]);return;}
var total=$(button_parent).parent().find("b").first();var label=$(button_parent).parent().find(is_good?".votes_good":".votes_bad");var rating=parseInt($(total).text());rating+=(is_good?1:-1);$(total).text((rating>0?"+":"")+rating);$(label).text(parseInt($(label).text())+1);$(total).attr("class",rating>0?"dl":rating==0?"null":"lt");$(button_parent).html("<b>Спасибо за Ваш голос!</b>");}});}
function Paper_Book_Basket(ArtID,e){var paper_book=$('*[class~="in_basket_quality_'+ArtID+'"] span'),paper_count=parseInt(paper_book.eq(0).text());if(paper_count==(!e?1:0)){!e?paper_book.parent().hide():paper_book.parent().show();if($('.coolbtn_basket .coolbtn_basket_'+ArtID)&&!e)$('.coolbtn_basket .coolbtn_basket_'+ArtID).show();else $('.coolbtn_basket .coolbtn_basket_'+ArtID).hide();}
!e?paper_count--:paper_count++;paper_book.html(paper_count);}
function CheckCardSvyaznoy(num){if(/^\d{13}$/.test(num)){num=num.toString();var numLast=num.charAt(num.length-1),numCount=num.slice(0,-1),count=0,numBig;for(var i=0;i<numCount.length;i++){if(i%2===0){count=parseInt(numCount[i])+parseInt(count);}else{count=(parseInt(numCount[i])*3)+parseInt(count);}}
numBig=Math.ceil(count/10)*10-count;if(numBig==numLast){return true;}else{return false;}}
return false;}
function LoyaltyValidate(loyalty,num){if((loyalty==='mnogoru'&&/^\d{8}$/.test(num))||((loyalty==='malina'||loyalty==='perekrestok')&&/^\d{16}$/.test(num))||(loyalty==='kukuruza'&&/^\d{13}$/.test(num))||(loyalty==='svyaznoy'&&CheckCardSvyaznoy(num))||(loyalty==='tnt'&&CheckCardTNT(num))||(loyalty==='beeline'&&/^\d{13}$/.test(num))||(loyalty==='rosneft'&&/^700599\d{10}$/.test(num))||(loyalty==='bpclub'&&/^7005993\d{9}$/.test(num))){return 1;}
if(loyalty==='svyaznoy')
{return'В номере карты Связной-Клуб допущена ошибка. Проверьте правильность ввода номера, расположенного на обороте под штрих-кодом, и повторите попытку.';}
return'Карта '+LoyaltyName(loyalty)+' заполнена не корректно!';}
function CheckCardTNT(num){if(/^\d{10}$/.test(num)){num=num.toString();var numLast=num.charAt(num.length-1),numCount=num.slice(0,-1),count=0,i;for(i=0;i<numCount.length;i++){count+=parseInt(numCount[i]);}
return(count%10==numLast)?true:false;}
return false;}
function LoyaltyName(loyalty){var lname=[];lname['mnogoru']='Много.ру';lname['malina']='МАЛИНА';lname['kukuruza']='Кукуруза';lname['perekrestok']='Перекресток';lname['svyaznoy']='Связной-Клуб';lname['tnt']='ТНТ-Клуб';lname['beeline']='Билайн';lname['rosneft']='«Семейная команда»';lname['bpclub']='«BP Club»';return lname[loyalty]?lname[loyalty]:loyalty;}
BodyLoadFunc.push({'ext-input-date':function(){if($('.ext-input-date').length){$('.ext-input-date').each(function(){var T=$(this),inp=T.find('input');T.css({'cursor':'pointer'}).click(function(){var TT=$(this);inp.datepicker("show");$('#ui-datepicker-div').css({'left':TT.offset().left+TT.outerWidth()-$('#ui-datepicker-div').outerWidth()+'px','top':TT.offset().top+TT.outerHeight()+'px'});}).find('input').css({'display':'none'}).after('<span class="ui-date-number"></span>');inp.datepicker({numberOfMonths:1,dateFormat:'yy-mm-dd'}).change(function(){var TT=$(this);var v_data=TT.val().split('-');TT.parent().find('.ui-date-number').html(parseInt(v_data[2],10)+" "+RusMonth([v_data[1]-1])+" "+v_data[0]);}).change();});}}});BodyLoadFunc.push({'autofill_code':function(){if($('.autofill_code').length){$('.autofill_code').keyup(function(){var code=this.value.split(' ').join('');if(/^(\d){4,16}$/.test(code)){code=code.replace(/\d{4}/g,function(a,b,c){return a+' ';});}
this.value=code.trim();});$('.autofill_code').keyup();}}});BodyEndFunc.push({'show_book_title':function(){function noTOC(){$("#hg-content").removeClass('preload_toc').html("<div style='font-size: 12px; min-height: 20px'>Оглавление недоступно</div>");}
$('#book_intro').click(function(){$("#hg-pop-tooltip").css({left:$('#book_intro').offset().left-55,top:$('#book_intro').offset().top+20});$('#hg-pop-tooltip, #hg-pop_close, #hg-overlay').show();$("#hg-content").addClass('preload_toc');GUJ.PutRequest({url:$('#spoiler_data').attr('data-url').replace(/dir\/.+/g,'dir/h/toc.xml'),HttpRType:'xml',OnData:function(data){var html='';if(data===null){noTOC();return false;}
$('toc-item',data).each(function(){html+='<div style="margin-left:'+(20*$(this).attr('deep'))+'px;">'+$(this).text()+'</div>';});$("#hg-content").removeClass('preload_toc').html('<div id="spoiler_data">'+html+'</div>');return false;},OnDataFail:function(){noTOC();return false;}});});}});BodyEndFunc.push({'bonus_rubles_block':function(){if($("input[name='summ'].ext-input").length){check_val($("input[name='summ'].ext-input").val());}
function check_val(val){if(val<=500){$('.put_money_more')
.removeClass('green')
.addClass('yellow')
.find('span')
.html('<span>Пополните счет более чем на <a class="put_money_amount" href="#">500</a> руб. и получите 100 бонусных рублей в подарок.</span>');}else if(val>500){putMoneyMore();}}
function putMoneyMore(){$('.put_money_more')
.removeClass('yellow')
.addClass('green')
.find('span')
.text('Поздравляем! Вы получите 100 бонусных рублей в подарок.');}
$("input[name='summ'].ext-input").bind('keyup keypress blur change',function(){check_val($(this).val());});$('.put_money_amount').live('click',function(e){$("input[name='summ'].ext-input").val(501);putMoneyMore();e.preventDefault();});}});BodyEndFunc.push({'landing':function(){if($('#click_pass_show').length){$('#click_pass_show label').click(function(){$(this).parent().hide();$('.l_pass_show').show();});$('.with_ac').click(function(){$(this).parent().hide();$('.ext-input').addClass('no_check');});}
var landing_check_txt=$('input[class=landing_check]').parent(),landing_check_button=landing_check_txt.parent().parent().find('button');if($('input[class=landing_check]:not(":checked")').length){landing_check_txt.css('color','red');landing_check_button.removeClass('btn-green-22').addClass('btn-gray-22');}
landing_check_txt.click(function(){if($('input[class=landing_check]:not(":checked")').length){landing_check_txt.css('color','red');landing_check_button.removeClass('btn-green-22');landing_check_button.addClass('btn-gray-22');}else if($('input[class=landing_check]:(":checked")').length){landing_check_txt.css('color','inherit');landing_check_button.addClass('btn-green-22');landing_check_button.removeClass('btn-gray-22');}});}});function landing_check(form,validate){var err_msg='';if($('input[class=landing_check]:not(":checked")').length){err_msg+=landing_unchecked_msg;}
if(form.find('[data-loyalty]').length){var loyalty=form.find('[data-loyalty]');if(LoyaltyValidate(loyalty.attr('data-loyalty'),loyalty.val())!==1)err_msg+=LoyaltyValidate(loyalty.attr('data-loyalty'),loyalty.val());}
if(validate&&err_msg){alert(err_msg);}
return validate?err_msg.length>0?false:true:err_msg.length>0?err_msg:1;}
function ValidateEmailForm(){the_form=document.getElementById('form_email_reg');err_msg='';err_msg+=ValidateMailField(the_form.new_login_mail);if(err_msg.length>0)alert(err_msg);return err_msg.length>0?false:true;}
BodyLoadFunc.push({'RebillQuickPurchase':function(){if($('#rebill-quick-purchase-bubble').length){$("#rebill-quick-purchase-bubble").overlay({speed:100,mask:{color:'#000',loadSpeed:200,opacity:0.7},load:false,fixed:false});rebill.SubmitRebill=function(Service,ServiceID){Summ=Math.ceil(rebill.price-rebill.amount);if(!/^(\w+)$/.test(Service)||!/^\d+$/.test(Summ)||!/^\d+$/.test(ServiceID))return;$("#rebill-quick-purchase-bubble").overlay().close();var qRequest={url:'/pages/ajax_create_order/',HttpRType:(Service=='po')?'xml':'json',OnData:function(Data){if(Service=='po'){rebill.ProcessPORebill(Data);}else if(Service=='mr'&&Data.status=='ok'&&Data.msg!=''){document.location.href=Data.msg;}else if(Data.status=='ok'&&Data.order>0){$('#waitorder-progress').overlay().load();Request_1.params.order_id=Data.order;SmsCheckTimeOut=setTimeout('GUJ.PutRequest(Request_1)',5000);}else if(Data.status=='error'){alert(Data.msg);}else{alert('При выполнении заказа произошла ошибка');}
return;},params:{service:Service,service_id:ServiceID,summ:Summ,ref_url:rebill.ref_url,passphrase:rebill.passphrase,rand:Math.random()}};GUJ.PutRequest(qRequest);return;}
rebill.ProcessPORebill=function(xml){var paymentData=new Array();paymentData['url']=$(xml).find("url").text();paymentData['method']=$(xml).find("method").text();paymentData['order-id']=$(xml).find("order-id").text();paymentData['params']=new Array();$(xml).find("param").each(function(){paymentData['params'][$(this).attr("name")]=$(this).text();});GUJ.PutRequest({url:paymentData['url'],Method:paymentData['method'],params:paymentData['params']});$('#waitorder-progress').overlay().load();Request_1.params.order_id=paymentData['order-id'];SmsCheckTimeOut=setTimeout('GUJ.PutRequest(Request_1)',5000);}
rebill.RebillQuickPurchase=function(o){if(typeof o!='object')return;$("#rebill-quick-purchase-bubble").overlay().load();$('#rebill-quick-purchase-bubble .buy_download_popup_text').html('Купить и скачать '+TypeAffixes(o.atype)+' '+o.name+
((o.price>0)?' за '+o.price+' <span class="litres_ruble">&#8381;</span>':'')+
'<p>Воспользуйтесь своими привязанными счетами для моментальной оплаты<br>без повторного ввода данных.</p>'+
'<strong style="display:block;">Оплата с моего счета или банковской карты:</strong>');rebill.ref_url='/pages/my_books/?action=create_custom_set&arts='+o.id+'&redir='+encodeURIComponent('/pages/my_books/?action=do_order');rebill.price=o.price;return false;}}}});function TypeAffixes(mem){var book_affix;switch(mem){case'text':book_affix='электронную книгу';break;case'readers':book_affix='ридер';break;case'audio':book_affix='аудиокнигу';break;case'hardcopy':book_affix='бумажную книгу';break;case'english':book_affix='книгу на английском';break;default:book_affix='книгу';}
return book_affix;}
BodyEndFunc.push({'NewCap_Adaptive':function(){var newcap=$('.ab-header');if(newcap.length){newcap.find('.ab-userinfo > ul > li.login .ab-popup > .ab-block-padding').append($('#login-bubble:not([data-header_center])').removeClass('bubble_overlay'));var q=$('#q');q.attr('autocomplete','off');function ChangeSearchPlaceholder(){if($(window).width()<=1024)
q.attr("placeholder",__l("Название книги или имя автора"));else
q.attr("placeholder",__l("Введите название книги или имя автора"));}
$(window).resize(function(){ChangeSearchPlaceholder();});ChangeSearchPlaceholder();var menu_li=$('.ab-userinfo > ul > li'),menu_li_a=$('.ab-userinfo > ul > li > a');menu_li_a.on('click',function(e){var T=$(this),t=T.parent(),$popup=t.find('.ab-dropdown');menu_li.not(t).removeClass('active');if($("#login-bubble[data-header_center]").length){$("#login-bubble").data("overlay").load();return false;}
if(!$popup.length){return;}
if(t.hasClass('basket')&&T.find('.ab-header_basket_spl_title_num').text()==0&&!t.hasClass('no_active'))
return true;e.preventDefault();e.stopPropagation();if(t.hasClass('no_active'))return;if(t.hasClass('active')||(t.hasClass('info')&&T.find('span').length==0)||(t.hasClass('basket')&&T.find('.ab-header_basket_spl_title_num').text()==0)){t.removeClass('active');if((t.hasClass('info')&&T.find('span').length==0))
t.addClass('no_hover');}
if(t.hasClass('spam_tickets')){var $popup=t.find('.ab-popup');if($popup.find('.spam_ticket').length){t.addClass('active');return;}
if(litres_user_id==0){t.find('.ab-userlink span').text('1');}else{t.find('.ab-userlink span').hide();}
t.addClass('active');$popup.find('.ab-popup-ab-info').addClass('loading');GUJ.PutRequest({url:"/pages/get_week_msgs/",params:{lite:1},Method:'get',OnHTML:function(html){var $html=$(html);var tickets_id=[];var cookie_tickets=[];if($html.find('a').length&&litres_user_id!=0){$html.find('a').each(function(i){var href=$(this).attr('href');var $parent=$(this).closest('.spam_ticket');/\?/i.test(href)?href+='&event=7':href+='?event=7';href+='&pin='+litres_user_id+'&ticket='+$parent.attr('data-id')+
'&utm_campaign=eml_'+$parent.attr('data-pack-id');$(this).attr('href',href);});}
$html.find('.ticket_status_sent').each(function(i){if(tickets_id.indexOf($(this).attr('data-id'))==-1){tickets_id.push($(this).attr('data-id'));}});if(getCookie('spam_tickets')){cookie_tickets=getCookie('spam_tickets').split(',');for(var i=0;i<cookie_tickets.length;i++){if($html.find('.spam_ticket[data-id='+cookie_tickets[i]+']').length){$html.find('.spam_ticket[data-id='+cookie_tickets[i]+']')
.removeClass('ticket_status_sent').addClass('ticket_status_delivered');}}}
loadDotDotDot(function(){$popup.find('.ab-popup-ab-info').append($html).removeClass('loading');if($popup.height()>600||$popup.find('.ab-pop-message').text().length>=1250){$popup.find('.ab-popup-ab-info').addClass('scrollbar').attr('id','ab-popup-ab-info');var scrollbar_info=new scrollbar($('#ab-popup-ab-info')[0],{show:true});}
$html.find('.spam_ticket_text').dotdotdot({height:100});$('.spam_ticket.ticket_status_sent').each(function(i){GUJ.PutRequest({url:"/pages/fake/",params:{action:"user_spam",user:litres_user_id,ticket:$(this).attr('data-id'),event:6,id:$(this).attr('data-pack-id')}});});if(!cookie_tickets.length||parseInt(t.find('.ab-userlink span').text())>0){if(litres_user_id==0){setCookie('spam_tickets',tickets_id.join(','),30,'/');}else{setCookie('spam_tickets',tickets_id.join(','),0,'/',0,30);}}});}});}
else t.addClass('active');if(t.hasClass('login')){LoadBubble('close');LoadBubble('load');}
if(t.hasClass('ab-books')){yaCounter2199583.reachGoal('ClickToMybook');}
if(t.hasClass('cash')){yaCounter2199583.reachGoal('ClickToPopUp');}
if(t.hasClass('basket')){yaCounter2199583.reachGoal('ClickToCart');}});menu_li
.on('click',function(e){e.stopPropagation();});var NoClose=false;$('#main-div,.ab-header, body').click(function(e){if(!NoClose)
menu_li.removeClass('active');});$('.ab-registration,.ab-login').on('click',function(){$("#login-bubble").data("overlay").load();if($(this).hasClass('ab-registration')){$('#login-bubble').addClass('quick-reg');$(".registration").css('visibility','inherit');$('#frm_quick_login').css('visibility','hidden');$("#div-quick-login").hide();$("#div-quick-reg").show();$('#quick_regform #new_login').focus();}
return false;});$('.ab-userinfo > ul.unreg li.info .icon-close').on('click',function(){$('.ab-userinfo > ul.unreg > li.info > a').click();});$("#login-bubble").overlay({fixed:false,speed:100,onClose:function(){NoClose=false;$('.ab-userinfo .login.active > a').click();$.mask.close();},onLoad:function(){$("html, body").animate({scrollTop:$('.ab-header').offset().top},1000);NoClose=true;$('.ab-userinfo .login:not(.active) > a').click();$(document).mask({color:'#000',loadSpeed:200,opacity:0.7,onBeforeClose:function(){$("#login-bubble").data("overlay").close();if($('.login-link-car').length)$("#login-bubble").data("overlay").close();}});}});$('#login_fast_inp, #code1, #l_email input[name="new_login"], #open_pwd_regl_inp, #corn_regform input[name="new_login"]').on('blur',function(){NewOpenPassToggle('_fast');});$('#show_pass_fast').on('change click',function(){NewOpenPassToggle('_fast');});$('#show_pass_reg').on('click',function(){NewOpenPassToggle('_reg');});$('#show_pass_landing').on('click',function(){NewOpenPassToggle('_landing');});$('#show_pass_regl').on('click',function(){NewOpenPassToggle('_regl');});$('#pwd_fast_inp').on('change keyup',function(){$('#open_pwd_fast_inp').val($(this).val());});$('#open_pwd_fast_inp').on('change keyup',function(){$('#pwd_fast_inp').val($(this).val());});$('.reg_input #new_login').on('blur',function(){if(MailOK($('#new_login').val())==2||MailOK($('#mail').val())==2){$('#bubble_login_mail').hide();}else{$('#bubble_login_mail').show().delay(5000).fadeOut();}});$('.reg_input #new_login').on('change',function(){showhidemail();});if(litres.isNewPayment){$('#header-popup-cash').on('click',function(){if(!NoClose){menu_li.removeClass('active');}
return Payment.open({ref_url:socnet_ref_url});});}}}});function loadDotDotDot(callback){var script=document.createElement('script');script.type='text/javascript';script.async=true;script.src='/static/jquery_plugs/dotdotdot/jquery.dotdotdot.min.js';script.onload=function(){callback();};document.body.appendChild(script);}
BodyEndFunc.push({'gift_notification':function(){var timer,inp=$('#user_email'),submit=$('#notification_sumbit');$('#gift_notification .tabs_nav a').click(function(e){e.preventDefault();var ts=$(this),tc=ts.attr('href');ts.closest('.tabs_nav').find('.active').removeClass('active');ts.closest('.tabs').find('.tab-content').removeClass('active');ts.addClass('active');$(tc).addClass('active');});clearTimeout(timer);inp.on("blur",function(e){MailVerify(inp,timer);});submit.click(function(){SwitchUsernameToMail();return false;});}});function MailVerify(inp,timer,type){timer=setTimeout(function(){if(inp.val()==''){if(type=='btn'){inp.parent().removeClass('mail_ok').addClass('mail_err');inp.parent().find('.error-arrow').html('Поле "электронная почта" не заполнено');return false;}else{inp.parent().removeClass('mail_ok mail_err');}}
else if(MailOK(inp.val())!=2){inp.parent().removeClass('mail_ok').addClass('mail_err');inp.parent().find('.error-arrow').html('Неправильно введен E-mail');inp.focus();return false;}
else{inp.parent().removeClass('mail_err').addClass('mail_ok');}},200);}
function SwitchUsernameToMail(){var timer,inp=$('#user_email'),email=inp.val(),gn=$("#gift_notification");if(MailOK(email)!=2){MailVerify(inp,timer,'btn');return false;}
var Request={url:'/pages/ajax_empty2/',Method:'POST',OnData:function(Data){if(Data&&Data.status=='ok'){gn.overlay().close();$("#user_emails").html(email);$("#notification_success").data("overlay").load();CSRF.sendRequest({url:'/pages/ajax_empty2/',Method:'POST',params:{action:'update_my_reg',mail:email,save_email:1,loginchange:1,gimmifreebooks:1,subscr_authors:1}});}
else{gn.overlay().close();$("#user_account").html(email);$('#i_login2').val(email);$("#join_accounts").data("overlay").load();}},params:{action:'check_email_for_user',email2check:email}};CSRF.sendRequest(Request);return false;}
function GiftsCoupone(params){var Request={url:'/pages/ajax_epmty/',method:'POST',OnData:function(Data){if(Data.actions_output.exists=='1'){$("#gift_notification").overlay().close();$('#join_accounts').find('.warning').html(Data.errors[0]);$('#join_accounts').find('.desc.wide').html('Рекомендуем провести объединение аккаунтов.');$("#join_accounts").data("overlay").load();$("input[name=login2]").val(Data.actions_output.login);}
else{$("#gift_notification").overlay().close();$("#user_emails").html(Data.actions_output.login);$("#notification_success").data("overlay").load();}},params:params};GUJ.PutRequest(Request);}
function AnalyticsEvent(type,id){_gaq.push(['_trackEvent',type]);yaCounter2199583.reachGoal(type);return true;}
function SwitchUserEmail(){var email=$('#user_email_2').val();if(MailOK(email)!=2){alert('Электронную почту необходимо указывать в правильном формате, например: ivan.ivanovich@litres.ru\n\n');$("#user_email_2").focus();return false;}
var Request={url:'/pages/ajax_epmty/',OnData:function(Data){if(Data=='ok'){alert('Вас E-mail успешно изменен.');$("#oz-bubble").overlay().close();}
else if(/email_exists/.test(Data[0])){$("#user_email_2").val('');alert('E-mail уже принадлежит другому пользователю. Возможно, вам следует восстановить пароль или объединить учетные записи.');}
else{alert('При добавлении E-mail произошла ошибка');}},params:{action:'store_n_confirm_email',email2subscr:email,rand:Math.random()}};GUJ.PutRequest(Request);return false;}
function CheckBookGift(books,type){if(type==0||type==1||type==4){var giftbook=$('#action_giftbook_header');if(giftbook.length){var giftbook_books=giftbook.find('.action_giftbook_books');if(books){giftbook.show();}else{giftbook.hide();}
giftbook.toggleClass('gift',(books>2));giftbook_books.text(3-parseInt(books));if(books<3){giftbook.find('.icon_book').each(function(index){var self=$(this);self.toggleClass('icon_book_basket',index<books);});}}}}
function simple_timer(sec,block){var time=sec;var hours=Math.floor(time/3600);time-=hours*3600;var minutes=Math.floor(time/60);time-=minutes*60;block.innerHTML=hours+":"+(minutes<10?'0'+minutes:minutes)+":"+(time<10?'0'+time:time);sec--;if(sec>=0){setTimeout(function(){simple_timer(sec,block);},1000);}else{location.reload(true);}}
var top_banner=(litres.isHeaderBanner?12:92);BodyEndFunc.push({'head-floating':function(){var header=$('#ab-header');if(header.length){$(window).scroll(function(){var top=$(document).scrollTop();if(top<top_banner){header.removeClass('ab-header_transform');if(litres.isHeaderBanner){$('#main-div').addClass('page-wrap-with_banner');}}
else{header.addClass('ab-header_transform');if(litres.isHeaderBanner){$('#main-div').removeClass('page-wrap-with_banner');}}});}}});function PayPalInit(o){var progress=$('<div style="position:fixed;left:0;top:0;width:100%;height:100%;opacity:0.2;background:#000 url(/static/new/i/payment-progress.gif) center center no-repeat;z-index:99999;"></div>');$('body').append(progress);var Request={url:'/pages/ajax_epmty/',params:{js:true,descr:62},HttpRType:'json',OnData:function(data){progress.remove();if(data){if(o.params.rebill&&data.url){top.location.href=data.url;}
if(data.token){dg.startFlow('https://www.paypal.com/incontext?token='+data.token);}}},OnDataFail:function(fake1,fake2){progress.remove();alert('Произошла ошибка. Платеж отклонен.');}};$.extend(true,Request,o);GUJ.PutRequest(Request);return false;}
function paypalCheckoutInit(){var _button;switch(window.paypalCheckoutMode){case'biblio_book':if($('#a_buypay_visa_west').length){_button=['a_buybtn_paypal','a_buypay_paypal','a_buypay_visa_west','a_buybtn_mastercard_west','a_buybtn_visa_west'];}else{_button=['a_buybtn_paypal','a_buypay_paypal'];}
break;case'put_money_on_account':_button=['paypal_checkout','paypal_checkout_west'];break;case'basket':_button=['a_buypay_paypal','a_buypay_visa_west'];break;default:return;}
paypal.checkout.setup("5ZWSBPP5RL49Q",{click:function(event){event.preventDefault();var _url;var _params={};var target=event.target;if(target.id==''&&target.tagName.match(/img/i)!==null){target=target.parentNode;}
switch(window.paypalCheckoutMode){case'biblio_book':var id_button;if(target.id=='a_buybtn_paypal'||target.id=='a_buypay_paypal'){id_button=$('#a_buypay_paypal');}else if(target.id=='a_buypay_visa_west'||target.id=='a_buybtn_mastercard_west'||target.id=='a_buybtn_visa_west'){id_button=$('#a_buypay_visa_west');}
var form=id_button.closest('form'),arts=form.children('input[name=arts]').val(),custom_set=form.children('input[name=custom_set]').val(),basket=form.children('input[name=descr]');_url='/pages/ajax_empty/';_params={js:true,descr:62,buy_now:true,action:'create_custom_set',save:false};if(target.id=='a_buypay_visa_west'||target.id=='a_buybtn_mastercard_west'||target.id=='a_buybtn_visa_west'){_params.mode='card';}
if(arts){_params.arts=arts;}
if(basket.length){_params.basket=true;}
if(custom_set){_url='/pages/proceed_payment/';_params.custom_set=custom_set;}else{_params.action='create_custom_set';}
_params.save=$('#paypal_save').is(':checked');break;case'put_money_on_account':_url='/pages/proceed_payment/';var custom_set=$('#payment-form').find('input[name=custom_set]').val();_params={js:true,descr:62,buy_now:true,save:$('#paypal_save').is(':checked'),summ:$('#GMCountCell').val()};if(custom_set){_params.custom_set=custom_set;}
if(target.id=='a_buypay_visa_west'||target.id=='a_buybtn_mastercard_west'||target.id=='a_buybtn_visa_west'||target.id=='paypal_checkout_west'){_params.mode='card';}
break;case'basket':var form=$('#a_buypay_paypal').closest('form'),arts=form.children('input[name=arts]').val(),custom_set=form.children('input[name=custom_set]').val(),basket=form.children('input[name=descr]');_url='/pages/ajax_empty/';_params={js:true,descr:62,buy_now:true,basket:true};if(arts){_params.arts=arts;}
if(basket.length){_params.basket=true;}
if(custom_set){_url='/pages/proceed_payment/';_params.custom_set=custom_set;}else{_params.action='create_custom_set';}
_params.save=$('#paypal_save').is(':checked');if(target.id=='a_buypay_visa_west'||target.id=='a_buybtn_mastercard_west'||target.id=='a_buybtn_visa_west'){_params.mode='card';}
break;default:return;};paypal.checkout.initXO();var action=$.ajax({url:_url,data:_params,dataType:"json"});action.done(function(data){paypal.checkout.startFlow(data.token);});action.fail(function(){paypal.checkout.closeFlow();});},button:_button});};$(function(){if(window.paypalCheckoutMode)
{window.paypalCheckoutReady=paypalCheckoutInit;var scr=document.createElement("script");scr.src="//www.paypalobjects.com/api/checkout.js";document.body.appendChild(scr);}});jQuery(document).on('yacounter2199583inited',function(){if(litres_user_id==0){$(".ab-userinfo .login a").on('click',function(){if(!$(this).parent().hasClass('active')){yaCounter2199583.reachGoal('login_register');}});$(".ab-userinfo .info a").on('click',function(){if(!$(this).parent().hasClass('active')){yaCounter2199583.reachGoal('bell');}});$(".ab-userinfo .free a").on('click',function(){if(!$(this).parent().hasClass('active')){yaCounter2199583.reachGoal('free-books');}});$(".ab-userinfo .info .ab-registration").on('click',function(){yaCounter2199583.reachGoal('bell_registration');});$(".ab-userinfo .free .ab-registration").on('click',function(){yaCounter2199583.reachGoal('free-books_registration');});$("#frmNewUserRegdata .reg_input .coolbtn").on('click',function(){yaCounter2199583.reachGoal('registration-page_sign_up');});$('.read-comfortably').on('click',function(){yaCounter2199583.reachGoal('read-comfortably');});$('.login-page_registration').on('click',function(){yaCounter2199583.reachGoal('login-page_registration');});$(".online_reading_pager a").live('click',function(){yaCounter2199583.reachGoal('read-online_pagination');});}
$('#header-avatar-icon').on('click',function(){yaCounter2199583.reachGoal('ClickToMyProfile');});for(var tests in litres.tests){if(litres.tests[tests]=='test'||litres.tests[tests]=='control'){yaCounter2199583.params({ab_test:tests+'_AB_'+litres.tests[tests]});}}
(function(){var obj={logged:!!litres.user};if(litres.user){obj.ID=litres.user;}
yaCounter2199583.userParams(obj);})();});function yaLogin_registration(){yaCounter2199583.reachGoal('login_registration');}
BodyEndFunc.push({'read_book_similar':function(){if($('#book-similar').length){$('#book-similar').addClass('book-similar_small').on('click',function(){$(this).removeClass('book-similar_small');});}}});function LastViewed(artID){var data=getCookie("last_viewed");var dataArr=new Array();var MaxQueueLen=30;if(data){dataArr=data.split(',');if(dataArr.indexOf(artID+"")!=-1)return;}
dataArr.push(artID);if(dataArr.length>MaxQueueLen){dataArr.splice(0,1);}
setCookie("last_viewed",dataArr,6,"/");}
BodyEndFunc.push({'web_push_popup':function(){$("#web-push .web-push-close").on("click",function(){$("#web-push").hide();});}});function formatPriceNumber(price){var _price=price*1;if(Math.round(_price)!==_price){parseFloat(_price);_price+='';_price=_price.replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,'$1 ');return _price.replace('.',',');}else{return parseInt(_price);}}
BodyEndFunc.push({'pobeda_landing':function(){if($('.pobeda_collection_page').length){$('#activate_button').on('click',function(e){if(!$('#code1').val().length){e.preventDefault();alert('Вы не ввели код купона');}});$('.free_get_now').on('click',function(e){e.preventDefault();GUJ.PutRequest({url:'/pages/ajax_epmty/',params:{action:'decr_user_gifts',art:$(this).closest('.book_right_info').find('.book_id').attr('data-id'),no_redirect:1},OnData:function(Data){if(Data=='ok'){window.location.reload();}else{alert(Data);}}});});}}});BodyEndFunc.push({'ya_metrika':function(){window.dataLayer=window.dataLayer||[];$('.basket-table .icon_delete').on('click',function(){var $attrs=$(this).prev();dataLayer.push({"ecommerce":{"currencyCode":"RUB","remove":{"products":[{"id":$attrs.attr('data-id'),"name":$attrs.attr('data-name')}]}}});});$('.push_to_basket_btn').on('click',function(){var self=$(this);dataLayer.push({"ecommerce":{"currencyCode":"RUB","add":{"products":[{"id":self.attr('data-id'),"name":self.attr('data-name'),"price":self.attr('data-price'),"quantity":1}]}}});});$('.ab-popup').on('click','.del_item_btn',function(){var self=$(this);dataLayer.push({"ecommerce":{"currencyCode":"RUB","remove":{"products":[{"id":self.attr('data-id'),"name":self.attr('data-name'),"quantity":1}]}}});});$('#clean-basket').on('click',function(){var $books=$('.basket-table:first input[name="attrs"]');var books=[];$books.each(function(indx,element){books.push({"id":$(element).attr('data-id'),"name":$(element).attr('data-name'),"quantity":1});});dataLayer.push({"ecommerce":{"currencyCode":"RUB","remove":{"products":books}}});});}});BodyEndFunc.push({'spam_tickets':function(){$('.ab-popup, [data-header_popup="info"]').on('click','.spoiler_link_readmore',function(e){e.preventDefault();var $self=$(this);_actionTracker($self);$self.next().show();$self.hide();});function _actionTracker(elem){var $self=elem;$('#art_action_tracker').attr('src','/pages/fake/?user='+litres_user_id+'&ticket='+
$self.attr('data-id')+'&event=6&id='+$self.attr('data-pack-id')+'&action=user_spam');}}});BodyEndFunc.push({'NewHeader':function(){var $header=$('#litres_header');var init=false;var previousScroll=0;var spamTicketsCount=0;if(litres.tests['test256']=='control'){spamTicketsCount=$('.spam-ticket[data-engine="site"]').length;}else{spamTicketsCount=$('#header-info-link').attr('data-msg-count');}
function toggleHeader(){var scrollTop=$(document).scrollTop();var downScroll=scrollTop>previousScroll;var upScroll=scrollTop<previousScroll;if(scrollTop>15){$header.css('top',0);$header.addClass('litres_header_slim');init=true;if(init&&downScroll){if(litres.isHeaderBanner){$('#main-div').removeClass('page-wrap-with_banner');}
$header.addClass('litres_header_slim');}
if(upScroll){$header.removeClass('litres_header_slim');if(litres.isHeaderBanner){$('#main-div').addClass('page-wrap-with_banner');}
init=false;}}else{if(downScroll){var top='-'+scrollTop+'px';$header.css('top',top);$header.removeClass('litres_header_slim');init=false;}
if(scrollTop===0){$header.css('top',0);$header.removeClass('litres_header_slim');init=false;}}
previousScroll=scrollTop;setPopupPos();}
function сhangeSearchPlaceholder(){var $q=$('#q');if($(window).width()<=1024){$q.attr('placeholder',__l('Название книги или имя автора'));}else{$q.attr('placeholder',__l('Введите название книги или имя автора'));}
if($q.width()<=250){$q.attr('placeholder',__l('Книга или автор'));}}
function getCoordsPopup($el,$popup){var $main_block=$header.find('.header_main');var $focus=$el.find('.header_popup_focus').length?$el.find('.header_popup_focus'):$el;var popup_left=$focus.offset().left-$popup.width()/2+$focus.width()/2;var coords=popup_left;if(popup_left+$popup.width()>$main_block.width()+$main_block.offset().left){coords=($main_block.width()-$popup.width())+$main_block.offset().left+parseInt($main_block.css('padding-left'));}
return coords;}
function setPopupPos($el,$popup){if(!$el&&!$popup){$el=$('[data-header_open].active');$popup=$('[data-header_popup="'+$el.attr('data-header_open')+'"]');if(!$el.length&&!$popup.length){return;}}
var popup_data=$el.attr('data-header_open');var is_menu_popup=$el.closest('.header_menu').length?true:false;var popup_left=(popup_data==='genres'?30:getCoordsPopup($el,$popup));var popup_top=(is_menu_popup?($header.height()-10)+'px':$header.height()-50+'px');$popup.css({left:popup_left+'px'}).addClass('header-popup_open');$popup.css({top:$header.hasClass('litres_header_slim')?$header.height()+'px':popup_top});if(popup_data!='genres'){setPopupArrow($el,$popup);}}
function hasFixedPopupArrow($popup){return $popup.hasClass('ab-popup_right-arrow');}
function setPopupArrow($el,$popup){var $focus=$el.find('.header_popup_focus').length?$el.find('.header_popup_focus'):$el;var $arrow=$popup.find('.header-popup__arrow-outer, .header-popup__arrow-inner');if(!$arrow.length){$arrow=$('<div class="header-popup__arrow-outer"></div><div class="header-popup__arrow-inner"></div>');$popup.append($arrow);}
if(!hasFixedPopupArrow($popup)){$arrow.css({left:$focus.offset().left+$focus.width()/2-$popup.offset().left-7+'px'});}}
function launchSocNet(){if(typeof SocNet!='undefined'){if(typeof(FB)=='undefined'){SocNet.push('fb',{InitCall:true});}
if(typeof(VK)=='undefined'){SocNet.push('vk',{InitCall:true});}
if(typeof(mailru)=='undefined'){SocNet.push('ma',{InitCall:true});}}}
function initHeaderPopups(){var menu_div=$('[data-header_open]');function hasHoverElement($self){return $self.find('.'+$self.attr('data-hover_zone_class')).length?true:false;}
function bindHoverHandlers($self){var timeout=1000;var hoverBtnTimerId;function onBtnHover(e){var $self=$(this),popup_attr=$self.attr('data-header_open'),$popup=$('[data-header_popup="'+popup_attr+'"]');hoverBtnTimerId=setTimeout(function(){if(!$self.hasClass('active')){$self.addClass('ab-popup_hovered');$popup.data('overlay').load();}},timeout);}
function onBtnHoverLost(e){var $self=$(this),popup_attr=$self.attr('data-header_open'),$popup=$('[data-header_popup="'+popup_attr+'"]');if($self.hasClass('ab-popup_hovered')){hoverPopupTimerId=setTimeout(function(){$self.removeClass('ab-popup_hovered');$popup.data('overlay').close();},timeout);}
clearTimeout(hoverBtnTimerId);}
var hoverPopupTimerId;function onPopupHover(e){if($self.hasClass('ab-popup_hovered')){clearTimeout(hoverPopupTimerId);}}
function onHoverLost(e){var popup_attr=$self.attr('data-header_open'),$popup=$('[data-header_popup="'+popup_attr+'"]');if($self.hasClass('ab-popup_hovered')){setTimeout(function(){$self.removeClass('ab-popup_hovered');$popup.data('overlay').close();},timeout);}}
$self.hover(onBtnHover,onBtnHoverLost);$('[data-header_popup="'+$self.attr('data-header_open')+'"]').hover(onPopupHover,onHoverLost);}
menu_div.each(function(i,element){var $self=$(element);var options={popup:$self.attr('data-header_open'),callback:$self.attr('data-header_open')=='info'?getSpamTickets:false}
if(hasHoverElement($self)){bindHoverHandlers($self);}
createPopupOverlay(options);});menu_div.on('click',function(e){e.preventDefault();e.stopPropagation();var $self=$(this);var popup_attr=$self.attr('data-header_open');var $popup=$('[data-header_popup="'+popup_attr+'"]');if(!$popup.length){return;}
var $target=$(e.target);if(hasHoverElement($self)&&$target.hasClass($self.attr('data-hover_zone_class'))){var $link=$self.find('a');window.location.href=$link.attr('href');return;}
getPopupOverlay($popup);});$('body').on('click',function(e){if(!$(e.target).closest('.header-popup').length){menu_div.each(function(i,element){$('[data-header_popup="'+$(element).attr('data-header_open')+'"]').data('overlay').close();});}});}
function createPopupOverlay(options){var $el=$('[data-header_open="'+options.popup+'"]');var $popup=$('[data-header_popup="'+options.popup+'"]');var is_menu_popup=$el.closest('.header_menu').length?true:false;var popup_top=(is_menu_popup?($header.height()-10)+'px':$header.height()-50+'px');$popup.overlay({fixed:(options.popup==='genres'?false:true),speed:0,onClose:function(){$el.removeClass('active');},onLoad:function(){$popup.css({'top':$header.hasClass('litres_header_slim')?$header.height()+'px':popup_top,'left':options.popup==='genres'?30:getCoordsPopup($el,$popup)});$popup.addClass('header-popup_open');$el.addClass('active');if(options.popup!='genres'){setTimeout(function(){setPopupArrow($el,$popup);},100);}
if(options.callback){options.callback();}
if(!litres.user&&options.popup=='login'){launchSocNet();}}});}
function getPopupOverlay(query){if(query.length){if(query.data("overlay").isOpened()){query.data("overlay").close();}else{query.data("overlay").load();}}}
function getSpamTickets(){var $bell=$('[data-header_open="info"]');var $bell_sticker=$bell.find('.popup_link_sticker');var $popup=$('[data-header_popup="info"]');var $html={};var tickets_id=[];var cookie_tickets=[];if($popup.find('.spam-ticket').length){$popup.show();return;}
if(!litres.user){$bell_sticker.text('1');}else{$bell_sticker.hide();}
$popup.addClass('loading');GUJ.PutRequest({url:"/pages/get_week_msgs/",params:{lite:1,header:'new'},Method:'get',OnHTML:function(html){$html=$(html);if($html.find('a').length&&litres.user){$html.find('a').each(function(i){var href=$(this).attr('href');var $parent=$(this).parent('.spam-ticket');/\?/i.test(href)?href+='&event=7':href+='?event=7';href+='&pin='+litres.user+'&ticket='+$parent.attr('data-id')+
'&utm_campaign=eml_'+$parent.attr('data-pack-id');$(this).attr('href',href);});}
$html.filter('.spam-ticket_sent').each(function(i){if(tickets_id.indexOf($(this).attr('data-id'))==-1){tickets_id.push($(this).attr('data-id'));}});if(getCookie('spam_tickets')){cookie_tickets=getCookie('spam_tickets').split(',');for(var i=0;i<cookie_tickets.length;i++){if($html.find('.spam-ticket[data-id='+cookie_tickets[i]+']').length){$html.find('.spam-ticket[data-id='+cookie_tickets[i]+']')
.removeClass('spam-ticket_sent').addClass('spam-ticket_delivered');}}}
loadDotDotDot(function(){$popup.find('.header-popup__inner').append($html);$popup.removeClass('loading');$bell.addClass('active');$popup.find('.spam-ticket__text').dotdotdot({height:80});setPopupPos($bell,$popup);$popup.show();if($popup.height()>460||$popup.find('.spam-ticket__message').text().length>=1250){$popup.find('.header-popup__inner').addClass('scrollbar').attr('id','header-popup__info');var scrollbar_info=new scrollbar($('#header-popup__info')[0],{show:true});}
$('.spam-ticket.spam-ticket_sent').each(function(i){GUJ.PutRequest({url:"/pages/fake/",params:{action:"user_spam",user:litres.user,ticket:$(this).attr('data-id'),event:6,id:$(this).attr('data-pack-id')}});});if(!cookie_tickets.length||parseInt($bell_sticker.text())>0){if(!litres.user){setCookie('spam_tickets',tickets_id.join(','),30,'/');}else{setCookie('spam_tickets',tickets_id.join(','),0,'/',0,30);}}});}});}
function setSpamTicketCount(xml_count){if(parseInt(xml_count)){var $sticker=$('[data-header_open="info"] .popup_link_sticker');var cookie_count=0;if(!getCookie('spam_tickets')||!$('.spam-tickets').length){$sticker.text(xml_count).css('display','inline-block');return;}
cookie_count=getCookie('spam_tickets').split(',');if(!litres.user){xml_count-=1;$sticker.text('1').css('display','inline-block');}
if(xml_count!==cookie_count.length){$sticker.text(xml_count).css('display','inline-block');}}}
function getGenresPopup(){var genresBubble='/static/ds/newgenres_bubble/'+window.location.hostname+'/index.html';genresBubble=genresBubble+(/\?/.test(genresBubble)?'&amp;':'?')+1;$.get(genresBubble,function(data){var $genreLinks=$('.bubble_genres');$genreLinks.append(data);var genreNum=0;$('.genres_more').each(function(){var t=$(this).text();genreNum+=parseInt(t.substr(4,2));});$('.bubble_allgenres a').text(__ln('Все {count} жанр','Все {count} жанров',genreNum,{count:genreNum}));$('.subgenre_bubble_list').css('height',$genreLinks.height()-24);$("#genres_popup").click(function(){$genreLinks.show();$('.bubble_subgenres, .bubble_back').hide();if(typeof yaCounter2199583!=='undefined'){yaCounter2199583.reachGoal('ClickToGenres');}});$('.bubble_back').on('click',function(){prev_genres.pop();if(prev_genres.length==0){$('.bubble_subgenres, .bubble_back').hide();$('.bubble_genres').show();}else{MoreGenres(prev_genres[prev_genres.length-1],true);}});});}
if($header.length){$('.header_nav [data-header_open="menu-more"]').show();if(!litres.user){var headerLoginForm=new LoginForm.LoginFormClass({form:$('#popup-login__form'),cssClass:'popup-login',addEvents:function(){$('.popup-login__terms-link').on('click',function(){ShowFrame('/pages/litres_oferta/',1);return false;});$('#popup-login__eye').on('click',function(){headerLoginForm.pass[0].type=(headerLoginForm.pass[0].type==='password')?'text':'password';return false;});$('#popup-login__header-link').on('click',function(){headerLoginForm.setStateForm('login');return false;});$('#popup-login__restore_link').on('click',function(){headerLoginForm.restorePass('login');return false;});$('#popup-login__details_link').on('click',function(){headerLoginForm.form.isAutoPwd=false;headerLoginForm.openPassword();return false;});$('#header_vkontakte_login').on('click',function(e){e.preventDefault();VKLoginClick(4259842);});$('#header_facebook_login').on('click',function(e){e.preventDefault();FBLoginClick('email,user_friends');});$('#header_ok_login').on('click',function(e){e.preventDefault();OKLoginClick('1247812096');});$('#header_twitter_login').on('click',function(e){e.preventDefault();TWLoginClick();});$('#header_mailru_login').on('click',function(e){e.preventDefault();MRLoginClick();});}});$('#popup-info__links-reg').on('click',function(){$('[data-header_popup="login"]').data('overlay').load();headerLoginForm.setStateForm('registration');return false;});$('#popup-info__links-enter').on('click',function(){$('[data-header_popup="login"]').data('overlay').load();headerLoginForm.setStateForm('login');return false;});}
initHeaderPopups();$(window).on('resize',function(){setTimeout(function(){сhangeSearchPlaceholder();},200);setPopupPos();});сhangeSearchPlaceholder();$(window).on('scroll',toggleHeader);if((!litres.user&&spamTicketsCount)||litres.tests['test256']=='control'){setSpamTicketCount(spamTicketsCount);}
getGenresPopup();$('.header_popup_link[data-header_open="library"]').removeClass('disabled');}}});function showPopupError(params){var params=params||{};var $failblock=$('#popup-login__action-error-block');var $popup=$('[data-header_popup="login"]');if(params.ref_url){$popup.find('#ref_url').attr('value',params.ref_url);}
$(document).mask({color:'#000',loadSpeed:200,opacity:0.4,onClose:function(){$failblock.hide();},onLoad:function(){$popup.data('overlay').load();}});if(params.html){$failblock.html(params.html).show();}
return false;}
BodyEndFunc.push({'z_asking_email':function(){if($('#main-div').length&&$('#main-div').attr('data-asking-email')==1){var temp_mail='';var loginScript=document.createElement('script');loginScript.type='text/javascript';loginScript.async=true;loginScript.src=window.location.origin+'/static/new/modules/login/js/login.js';loginScript.onload=askingEmail;document.body.appendChild(loginScript);function askingEmail(){var askingMailForm=new LoginForm.LoginFormClass({form:$('.asking-email__form'),usage:'asking-email',custom_set:$('.asking-email__form').attr('data-custom-set'),cssClass:'asking-email',addEvents:function(){$('#asking-email__eye').on('click',function(){askingMailForm.pass[0].type=(askingMailForm.pass[0].type==='password')?'text':'password';return false;});}});if(litres_user_id!=0){askingMailForm.form.attr('data-action','update-mail');}else{askingMailForm.form.attr('data-action','create-stat-user');}
askingMailForm.form.find('input[name=ref_url]').val(window.location.pathname+
window.location.search);askingMailForm.resetForm=function(){askingMailForm.form.attr({'data-state':'registration','data-action':litres_user_id!=0?'update-mail':'create-stat-user'});};askingMailForm.merge2Users=function(){var self=this;self.form.find('.asking-email__input-password')
.before('<div class="asking-email__merge">'+makeMergeBlock()+'</div>');self.form.find('.asking-email__input_wrapper:not(.asking-email__input-password)').hide();self.form.find('.asking-email__text').hide();self.form.attr('data-action','merge-users');function makeMergeBlock(){return'<div class="asking-email__merge-text">Выберите основной аккаунт, который Вы бы хотели оставить. '+
'Все купленные книги со второго аккаунта и баланс счета переедут на него:</div>'+
'<ul class="asking-email__merge-users">'+
makeLiWithLogin('second',self.email.val(),false)+
'</ul>'+
'<div class="asking-email__merge-text">Для подтверждения объединения введите пароль <strong>'+
self.email.val()+'</div>';}
function makeLiWithLogin(id,login,checked){return'<li>'+
'<input type="radio" name="merge-item" class="asking-email__merge-item" value="'+login+'" '+
'id="'+id+'"'+(checked?' checked="checked"':'')+' />'+
'<label class="but_unite" for="'+id+'">'+
login+(id=='login'?' <span>(текущий аккаунт)</span>':'')+
'</label>'+
'</li>';}};askingMailForm.email.on('keyup focusout input',function(){if(temp_mail!==askingMailForm.email.val()){askingMailForm.resetForm();}});$('.webmoney_standart_button').on('click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this);$('.putmoney_webmoney .putmoney').hide();$('.putmoney_webmoney .asking-email').show();askingMailForm.form.find('input[name=ref_url]').val('');askingMailForm.config.submitCallback=function(){$this.closest('form').submit();};});askingMailForm.form.find('.asking-email__button').on('click',function(){temp_mail=askingMailForm.email.val();});askingMailForm.form.find('.asking-email__change_link').on('click',function(e){e.preventDefault();askingMailForm.clearInputs();askingMailForm.resetForm();askingMailForm.email.focus();});}}}});BodyLoadFunc.push({'phonecode_popup':function(){var phone=$('.ext-phone-wrapper'),select=$('.ext-select-wrapper'),input=$('.ext-input-wrapper').find('input'),phonecodes={};if(select.length){GUJ.PutRequest({url:'/pages/countriez_phones/',HttpRType:'json',OnData:function(data){var pcCookie=getCookie('phonecode');phonecodes=data.countriez;phone.addClass('show-select');select.css('display','table-cell');if(my_account_phone&&my_account_tcountry){getPhoneCode({phone:my_account_phone,tcountry:my_account_tcountry},phone);}else if(getCookie('phonecode')){var pcCookie=getCookie('phonecode').split(',');FillPhoneCode({code:pcCookie[0].replace('+',''),phone:pcCookie[0].replace('+',''),tcountry:pcCookie[1],mask:pcCookie[2]},phone);}else{FillPhoneCode({code:'7',phone:'7',tcountry:'RU',mask:'xxx xxx xx xx'},phone);}}});$('#frmUpdateUserRegdata').on('submit',function(){if($('.ext-phone-input').val().length>0){$('[name="phone"]').val($('.ext-phone-select').text()+' '+$('.ext-phone-input').val());}});select.on('click',function(){if(!$('#overlay_phonecode').length){var html='<div class="phonecode_popup">';phonecodes.sort(function(arr1,arr2){if(arr1.name<arr2.name)return-1;if(arr1.name>arr2.name)return 1;return 0;});for(var i=0;i<phonecodes.length;i++){var tel=phonecodes[i].tel_codes,code=phonecodes[i].code,name=phonecodes[i].name;for(var j=0;j<tel.length;j++){var tel_code=tel[j].tel_code,tel_mask=tel[j].tel_mask;html+='<div class="phonecode_popup__row"><div class="phonecode_popup__code"';if(tel_mask){html+=' data-mask="'+tel_mask.substr(tel_mask.indexOf(' ')+1).toLowerCase()+'"';}
html+=' data-tcountry="'+phonecodes[i].code+'">+'+tel_code+'<span class="ext-flag flag__'+code.toLowerCase()+'"></span></div><div class="phonecode_popup__country">'+name+'</div></div>';}}
html+='</div>';phone.append(html);$('<div class="overlay_phonecode" id="overlay_phonecode"></div>').appendTo('body').show();}
phonecodePopupShow();});}
$('body').on('click','.phonecode_popup__row',function(){var t=$(this),mask=t.find('.phonecode_popup__code').attr('data-mask'),tcountry=t.find('.phonecode_popup__code').attr('data-tcountry');input.val('');select.find('span').removeClass().addClass(t.find('span').attr('class'));select.find('div').text(t.find('.phonecode_popup__code').text());select.attr('data-tcountry',tcountry);phone.find('[name="tcountry"]').val(tcountry);if(mask){input.inputmask({mask:mask.toString().replace(/x/g,'9'),placeholder:mask}).attr('placeholder',mask);}else{input.inputmask({mask:'99999999999999999999',placeholder:''}).attr('placeholder','');}
setCookie('phonecode',t.find('.phonecode_popup__code').text()+','+t.find('.phonecode_popup__code').attr('data-tcountry')+(mask?(','+mask):''),365,'/');phonecodePopupShow();});$('body').on('click','#overlay_phonecode',function(){$(this).hide();phonecodePopupShow();});function phonecodePopupShow(){var overlay=$('#overlay_phonecode');phone.toggleClass('active');if(phone.hasClass('active')){overlay.show();}else{overlay.hide();}}
function FillPhoneCode(params,wrapper){select.find('.ext-phone-select').text('+'+params.code);select.find('span').removeClass().addClass('ext-flag flag__'+params.tcountry.toLowerCase());select.attr('data-tcountry',params.tcountry);if(params.mask){input.inputmask({mask:params.mask.toString().replace(/x/g,'9'),placeholder:params.mask}).attr({'data-mask':params.mask,'placeholder':params.mask});}else{input.inputmask({mask:'99999999999999999999',placeholder:''}).attr({'data-mask':'','placeholder':''});}
input.val(params.phone.substr(params.code.length));$('input[name="tcountry"]').val(params.tcountry);}
function getPhoneCode(params,wrapper){params.phone=params.phone.replace(/(\+|\s)/g,'');for(var i=0;i<phonecodes.length;i++){var tel=phonecodes[i].tel_codes,code=phonecodes[i].code;for(var j=0;j<tel.length;j++){var tel_code=tel[j].tel_code,tel_mask=tel[j].tel_mask;if(params.tcountry==code||!params.tcountry&&params.phone.indexOf(tel_code)==0&&(code!='KZ'||code!='AX')){var mask=(tel_mask?tel_mask.substr(tel_mask.indexOf(' ')+1).toLowerCase():'');FillPhoneCode({code:tel_code,phone:params.phone,tcountry:code,mask:mask},wrapper);return false;}}}}}});function setSpamTicketCount(xml_count){if(parseInt(xml_count)){var $span=$('.ab-userinfo .ab-userlink span');var cookie_count=0;if(!getCookie('spam_tickets')||!$('.spam_tickets').length){$span.text(xml_count).css('display','inline-block');return;}
cookie_count=getCookie('spam_tickets').split(',');if(litres_user_id==0){xml_count-=1;$span.text('1').css('display','inline-block');}
if(xml_count!==cookie_count.length){$span.text(xml_count).css('display','inline-block');}}}
BodyEndFunc.push({'z_question_overlay':function(){if(ABTests.test235=='test'){var qovPopup=getCookie('qovPopup');if(qovPopup!=1){setTimeout(function(){var $body=$('body'),FrameUrl='https://docs.google.com/forms/d/e/1FAIpQLSdz87nRSUqQMJSRTHywAY_PHzFMcSzjin86W-UqISz9bZImGA/viewform?embedded=true',timer=false;$body.addClass('noscroll').append('<div class="question-overlay" id="question-overlay"><div class="question-wrapper"><a id="qv-close">'+__l("Закрыть")+'</a><iframe class="question-iframe" src="'+FrameUrl+'"></iframe></div></div>');setCookie('qovPopup','1',30,'/');YaCounter('show_popup_anketa_statluche');setTimeout(function(){timer=true;},10000);$('#qv-close').on('click',function(){$('#question-overlay').hide();$body.removeClass('noscroll');if(timer==true){YaCounter('closed_more_10_sek_popup_anketa_statluche');}else{YaCounter('closed_less_10_sek_popup_anketa_statluche');}});},10000);}}
if(ABTests.test242=='test'){var slPopup=getCookie('slPopup');if(slPopup!=1){setTimeout(function(){var $body=$('body');$body.addClass('noscroll').append('<div class="survey__litr-overlay" id="survey__litr-overlay">'
+'	<div class="survey__litr-wrapper">'
+'		<a id="sl-close"></a>'
+'		<div class="h1">Помогите ЛитРес стать лучше!</div>'
+'		<div class="sl-title">'
+'			Пройдите опрос* и получите<br/>'
+'			<span class="uppercase">книгу в подарок</span>'
+'		</div>'
+'		<div class="sl-btn-orange" id="sl-btn-orange"><a href="https://docs.google.com/forms/d/e/1FAIpQLSdBbz5PTjGybq_FG99gI636D9YDgpAiDBF9W4zPSwPi8jmP6Q/viewform" target="_blank">Пройти опрос</a></div>'
+'		<div class="sl-time">*опрос займет 7-8 минут</div>'
+'	</div>'
+'</div>');setCookie('slPopup','1',30,'/');YaCounter('show_popup_for_biggoogleform_bookgift');$('#sl-close').on('click',function(){$('#survey__litr-overlay').hide();$body.removeClass('noscroll');});$('#sl-btn-orange').on('click',function(){YaCounter('click_link_popup_for_biggoogleform_bookgift');});},10000);}}}});BodyEndFunc.push({'z_popup-merge-users':function(){$(function(){var cookieForMerge=getCookie('user_mail_merge');if(getCookie('just_bought')&&cookieForMerge&&cookieForMerge==litres_user_id){loadPopupCss();loadPopupHTML();}
function loadPopupCss(){$('head').append('<link rel="stylesheet" href="/static/new/css/p/popup-merge-users.css" type="text/css">');}
function loadPopupHTML(){var popup='/static/litres/inc/ru/popup-merge-users.html';$.get(popup,function(data){$('body').append(data);createPopup();});}
function createPopup(){var $popup=$('#popup-merge-users');$popup.overlay({load:false,speed:100,mask:{color:'#000',loadSpeed:200,opacity:0.7},onLoad:function(){YaCounter('MergePopupShow');},onClose:function(){$.mask.close();},left:'50%',fixed:false,noscroll:true});$popup.find('#popup-merge-users__user-mail').attr('href',litres.email).text(litres.email);$popup.data('overlay').load();setCookie('user_mail_merge','',-1,'/');$popup.find('#popup-merge-users__button').on('click',function(){CSRF.sendRequest({url:'/pages/ajax_empty2/',Method:'POST',params:{action:'unite_users',id:'all'},OnData:function(data){$popup.find('.popup-merge-users__button-block').hide();$popup.find('.popup-merge-users__mail-block').show();},OnDataFail:function(data){console.error('Ошибка',data);}});YaCounter('MergePopupConfirm');});}});}});function YaCounter(event){if(typeof yaCounter2199583!=='undefined'){yaCounter2199583.reachGoal(event);}}
var prev_genres=[];function MoreGenres(genre,prev){var genresBubble='/static/ds/newgenres_bubble/'+window.location.hostname+'/'+genre+'.html',genres=$('.bubble_genres'),subgenres=$('.bubble_subgenres');genresBubble=genresBubble+(/\?/.test(genresBubble)?'&amp;':'?')+1;$.get(genresBubble,function(data){subgenres.html(data).show();$('.subgenre_bubble_list li a:first-child, .subgenre_bubble_head').each(function(){var t=$(this);t.text(t.text().substr(0,1).toUpperCase()+t.text().substr(1));});$('.bubble_back').show();if(!prev){prev_genres.push(genre);}
var sg_list=$('.subgenre_bubble_list').find('li'),container=$('.subgenre_bubble_list_wrapper'),sg_height=genres.height()-71,total_height=0;container.css('height',sg_height);sg_list.each(function(i){var t=$(this),height=t.height();if(total_height+height>=sg_height||i==sg_list.length-1){$('<ul class="subgenre_bubble_list">').append(t.prevAll().andSelf()).appendTo(container);total_height=0;}else{total_height+=height;}});$('.subgenre_bubble_list').first().remove();var $scrollbar=$('.subgenre_bubble_list_wrapper');scrollbar_genres=new scrollbar($scrollbar[0],{show:true,width:'auto',scrollareaY:false});genres.hide();});}
BodyEndFunc.push({'z_get_age_limit_error':function(){var $ageErrorBlock=$('.get_age_limit_error');$ageErrorBlock.on('click',function(e){e.preventDefault();alert(__l('Запрашиваемая книга не соответствует вашему возрасту.\nВыберите другую книгу.'));return false;});}});BodyEndFunc.push({'z_check_error_img':function(){$(window).load(function(){litres.loadJs('/static/litres/modules/no-cover/js/no-cover.js',function(){setNoImgCovers();});});}});(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.overlay={addEffect:function(a,b,d){c[a]=[b,d]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var b=[],c={};a.tools.overlay.addEffect("default",function(b,c){var d=this.getConf(),e=a(window);d.fixed||(b.top+=e.scrollTop(),b.left+=e.scrollLeft()),b.position=d.fixed?"fixed":"absolute",this.getOverlay().css(b).fadeIn(d.speed,c)},function(a){this.getOverlay().fadeOut(this.getConf().closeSpeed,a)});function d(d,e){var f=this,g=d.add(f),h=a(window),i,j,k,l=a.tools.expose&&(e.mask||e.expose),m=Math.random().toString().slice(10);l&&(typeof l=="string"&&(l={color:l}),l.closeOnClick=l.closeOnEsc=!1);var n=e.target||d.attr("rel");j=n?a(n):null||d;if(!j.length)throw"Could not find Overlay: "+n;d&&d.index(j)==-1&&d.click(function(a){f.load(a);return a.preventDefault()}),a.extend(f,{load:function(d){if(f.isOpened())return f;var i=c[e.effect];if(!i)throw"Overlay: cannot find effect : \""+e.effect+"\"";e.oneInstance&&a.each(b,function(){this.close(d)}),d=d||a.Event(),d.type="onBeforeLoad",g.trigger(d);if(d.isDefaultPrevented())return f;k=!0,l&&a(j).expose(l);var n=e.top,o=e.left,p=j.outerWidth({margin:!0}),q=j.outerHeight({margin:!0});typeof n=="string"&&(n=n=="center"?Math.max((h.height()-q)/2,0):parseInt(n,10)/100*h.height()),o=="center"&&(o=Math.max((h.width()-p)/2,0)),i[0].call(f,{top:n,left:o},function(){k&&(d.type="onLoad",g.trigger(d))}),l&&e.closeOnClick&&a.mask.getMask().one("click",f.close),e.closeOnClick&&a(document).on("click."+m,function(b){a(b.target).parents(j).length||f.close(b)}),e.closeOnEsc&&a(document).on("keydown."+m,function(a){a.keyCode==27&&f.close(a)});return f},close:function(b){if(!f.isOpened())return f;b=b||a.Event(),b.type="onBeforeClose",g.trigger(b);if(!b.isDefaultPrevented()){k=!1,c[e.effect][1].call(f,function(){b.type="onClose",g.trigger(b)}),a(document).off("click."+m+" keydown."+m),l&&a.mask.close();return f}},getOverlay:function(){return j},getTrigger:function(){return d},getClosers:function(){return i},isOpened:function(){return k},getConf:function(){return e}}),a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}}),i=j.find(e.close||".close"),!i.length&&!e.close&&(i=a("<a class=\"close\"></a>"),j.prepend(i)),i.click(function(a){f.close(a)}),e.load&&f.load()}a.fn.overlay=function(c){var e=this.data("overlay");if(e)return e;a.isFunction(c)&&(c={onBeforeLoad:c}),c=a.extend(!0,{},a.tools.overlay.conf,c),this.each(function(){e=new d(a(this),c),b.push(e),a(this).data("overlay",e)});return c.api?e:this}})(jQuery);(function(a){var b=a.tools.overlay,c=a(window);a.extend(b.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function d(a){var b=a.offset();return{top:b.top+a.height()/2,left:b.left+a.width()/2}}var e=function(b,e){var f=this.getOverlay(),g=this.getConf(),h=this.getTrigger(),i=this,j=f.outerWidth({margin:!0}),k=f.data("img"),l=g.fixed?"fixed":"absolute";if(!k){var m=f.css("backgroundImage");if(!m)throw"background-image CSS property not set for overlay";m=m.slice(m.indexOf("(")+1,m.indexOf(")")).replace(/\"/g,""),f.css("backgroundImage","none"),k=a("<img src=\""+m+"\"/>"),k.css({border:0,display:"none"}).width(j),a("body").append(k),f.data("img",k)}var n=g.start.top||Math.round(c.height()/2),o=g.start.left||Math.round(c.width()/2);if(h){var p=d(h);n=p.top,o=p.left}g.fixed?(n-=c.scrollTop(),o-=c.scrollLeft()):(b.top+=c.scrollTop(),b.left+=c.scrollLeft()),k.css({position:"absolute",top:n,left:o,width:0,zIndex:g.zIndex}).show(),b.position=l,f.css(b),k.animate({top:b.top,left:b.left,width:j},g.speed,function(){f.css("zIndex",g.zIndex+1).fadeIn(g.fadeInSpeed,function(){i.isOpened()&&!a(this).index(f)?e.call():f.hide()})}).css("position",l)},f=function(b){var e=this.getOverlay().hide(),f=this.getConf(),g=this.getTrigger(),h=e.data("img"),i={top:f.start.top,left:f.start.left,width:0};g&&a.extend(i,d(g)),f.fixed&&h.css({position:"absolute"}).animate({top:"+="+c.scrollTop(),left:"+="+c.scrollLeft()},0),h.animate(i,f.closeSpeed,b)};b.addEffect("apple",e,f)})(jQuery);(function(a){a.tools=a.tools||{version:"v1.2.7"};var b;b=a.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,canClose:!0,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};function c(){if(a.browser.msie){var b=a(document).height(),c=a(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,b-c<20?c:b]}return[a(document).width(),a(document).height()]}function d(b){if(b)return b.call(a.mask);}var e,f,g,h,i;a.mask={load:function(j,k){if(g)return this;typeof j=="string"&&(j={color:j}),j=j||h,h=j=a.extend(a.extend({},b.conf),j),e=a("#"+j.maskId),e.length||(e=a("<div/>").attr("id",j.maskId),a("body").append(e));var l=c();e.css({position:"absolute",top:0,left:0,width:l[0],height:l[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex}),j.color&&e.css("backgroundColor",j.color);if(d(j.onBeforeLoad)===!1)return this;j.closeOnEsc&&a(document).on("keydown.mask",function(b){b.keyCode==27&&a.mask.close(b)}),j.closeOnClick&&e.on("click.mask",function(b){a.mask.close(b)}),a(window).on("resize.mask",function(){a.mask.fit()}),k&&k.length&&(i=k.eq(0).css("zIndex"),a.each(k,function(){var b=a(this);/relative|absolute|fixed/i.test(b.css("position"))||b.css("position","relative")}),f=k.css({zIndex:Math.max(j.zIndex+1,i=="auto"?0:i)})),e.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){a.mask.fit(),d(j.onLoad),g="full"}),g=!0;return this},close:function(c){if(g){if(!h.canClose){h.canClose=!0;return this;}if(d(h.onBeforeClose)===!1)return this;e.fadeOut(h.closeSpeed,function(){d(h.onClose),f&&f.css({zIndex:i}),g=!1}),a(document).off("keydown.mask"),e.off("click.mask"),a(window).off("resize.mask")}return this},fit:function(){if(g){var a=c();e.css({width:a[0],height:a[1]})}},getMask:function(){return e},isLoaded:function(a){return a?g=="full":g},getConf:function(){return h},getExposed:function(){return f}},a.fn.mask=function(b){a.mask.load(b);return this},a.fn.expose=function(b){a.mask.load(b,this);return this}})(jQuery);
